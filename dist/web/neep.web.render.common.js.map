{"version":3,"file":"neep.web.render.common.js","sources":["../../src/core/render/recursive.ts","../../src/web/update.ts","../../src/web/index.ts"],"sourcesContent":["export interface RecursiveArray<T> extends Array<RecursiveItem<T>>{};\nexport type RecursiveItem<T> = T | RecursiveArray<T>;\n\nexport function *recursive2iterable<T>(\n\tlist: RecursiveItem<T>,\n): Iterable<T> {\n\tif (!Array.isArray(list)) {\n\t\tyield list;\n\t\treturn;\n\t}\n\tfor (const it of list) {\n\t\tyield* recursive2iterable(it);\n\t}\n}\n","import {\n\trecursive2iterable, RecursiveItem,\n} from '../core/render/recursive';\n\nfunction getId(v: any): string | undefined {\n\tif (typeof v === 'string') { return v; }\n\tif (typeof v === 'number') { return String(v); }\n\treturn undefined;\n}\nfunction getClass(\n\tlist: RecursiveItem<(string | {[k: string]: any})>\n): Set<string> | undefined {\n\tconst set = new Set<string>();\n\tfor (const v of recursive2iterable(list)) {\n\t\tif (!v) { continue; }\n\t\tif (typeof v === 'string') {\n\t\t\tfor (let k of v.split(' ').filter(Boolean)) {\n\t\t\t\tset.add(k);\n\t\t\t}\n\t\t} else if (typeof v === 'object') {\n\t\t\tfor (const k in v) {\n\t\t\t\tconst add = v[k];\n\t\t\t\tfor (let it of k.split(' ').filter(Boolean)) {\n\t\t\t\t\tset[add ? 'add' : 'delete'](it);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (!set.size) { return undefined; }\n\treturn set;\n}\n\nfunction getStyle(\n\tstyle: any\n): string | Record<string, [string, 'important' | null]> | undefined {\n\tif (typeof style === 'string') { return style; }\n\tif (!style) { return undefined; }\n\tif (typeof style !== 'object') { return undefined; }\n\tconst css: Record<string, [string, 'important' | null]> =\n\t\tObject.create(null);\n\tfor (let k in style) {\n\t\tlet value = style[k];\n\t\tconst key = k.substr(0, 2) === '--' ? k\n\t\t\t: k.replace(/[A-Z]/g, '-$1')\n\t\t\t\t.replace(/-+/g, '-')\n\t\t\t\t.toLowerCase();\n\t\tif (typeof value === 'number') {\n\t\t\tcss[key] = [value === 0 ? '0' : `${value}px`, null];\n\t\t} else if (value && typeof value === 'string') {\n\t\t\tconst v = value.replace(/\\!important\\s*$/, '');\n\t\t\tcss[key] = [v, v === value ? null : 'important'];\n\t\t}\n\t}\n\treturn css;\n}\n\nfunction stringify(data: any, isOn = false): string | null {\n\tif (data === undefined || data === null) { return null; }\n\tif (isOn && typeof data === 'function') { return null; }\n\tif (typeof data === 'boolean') { return data ? '' : null; }\n\tif (typeof data !== 'object') { return String(data); }\n\tif (data instanceof Date) {\n\t\treturn data.toISOString();\n\t}\n\tif (data instanceof RegExp) {\n\t\treturn data.toString();\n\t}\n\treturn JSON.stringify(data);\n}\nfunction getAttrs(props: {[k: string]: any}) {\n\tconst attrs: Record<string, string> = Object.create(null);\n\tfor (const k in props) {\n\t\tconst name = k\n\t\t\t.replace(/([A-Z])/g, '-$1')\n\t\t\t.replace(/(\\-)\\-+/g, '$1')\n\t\t\t.toLowerCase();\n\t\tswitch(name) {\n\t\t\tcase 'is': continue;\n\t\t\tcase 'id': continue;\n\t\t\tcase 'style': continue;\n\t\t\tcase 'class': continue;\n\t\t}\n\t\tconst value = stringify(props[k], name.substr(0, 2) === 'on');\n\t\tif (value !== null) { attrs[name] = value; }\n\t}\n\treturn attrs;\n}\nfunction getEvent(props: {[k: string]: any}) {\n\tconst evt: Record<string, Set<EventListener>> = Object.create(null);\n\tfor (const k in props) {\n\t\tconst f = props[k];\n\t\tif (typeof f !== 'function') { continue; }\n\t\tif (k.substr(0, 2) !== 'on') { continue; }\n\t\tevt[k.substr(2).toLowerCase()] = new Set([f]);\n\t}\n\treturn evt;\n}\ninterface Props {\n\tid?: string;\n\tclasses?: Set<string>;\n\tstyle?: string | Record<string, [string, 'important' | null]>;\n\tattrs: Record<string, string>;\n\tevent: Record<string, Set<EventListener>>;\n}\nfunction getProps({\n\tid,\n\tclass: className,\n\tstyle,\n\t...attrs\n}: {[k: string]: any}): Props {\n\treturn {\n\t\tid: getId(id),\n\t\tclasses: getClass(className),\n\t\tstyle: getStyle(style),\n\t\tattrs: getAttrs(attrs),\n\t\tevent: getEvent(attrs),\n\t};\n}\n\nfunction updateClass(\n\tel: HTMLElement | SVGElement,\n\tclasses?: Set<string>,\n\toClasses?: Set<string>,\n) {\n\tif (classes && oClasses) {\n\t\tconst list = el.getAttribute('class') || '';\n\t\tconst classList = new Set(list.split(' ').filter(Boolean));\n\t\toClasses.forEach(c => classList.delete(c));\n\t\tclasses.forEach(c => classList.add(c));\n\t\tel.setAttribute('class', [...classList].join(' '));\n\t} else if (classes) {\n\t\tel.setAttribute('class', [...classes].join(' '));\n\t} else if (oClasses) {\n\t\tel.removeAttribute('class');\n\t}\n}\nfunction updateStyle(\n\tcss: CSSStyleDeclaration,\n\tstyle?: string | Record<string, [string, 'important' | null]>,\n\toStyle?: string | Record<string, [string, 'important' | null]>,\n) {\n\tif (!style) {\n\t\tif (!oStyle) { return; }\n\t\tif (typeof oStyle === 'string') {\n\t\t\tcss.cssText = '';\n\t\t\treturn;\n\t\t}\n\t\tfor (const k of Object.keys(oStyle)) {\n\t\t\tcss.removeProperty(k);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (typeof style === 'string') {\n\t\tif (style !== typeof oStyle) {\n\t\t\tcss.cssText = style;\n\t\t}\n\t\treturn;\n\t}\n\tif (!oStyle || typeof oStyle === 'string') {\n\t\tif (typeof oStyle === 'string') {\n\t\t\tcss.cssText = '';\n\t\t}\n\t\tfor (const k of Object.keys(style)) {\n\t\t\tcss.setProperty(k, ...style[k]);\n\t\t}\n\t\treturn;\n\t}\n\n\tfor (const k of Object.keys(style)) {\n\t\tconst v = style[k];\n\t\tif (\n\t\t\t!oStyle[k]\n\t\t\t|| oStyle[k][0] !== v[0]\n\t\t\t|| oStyle[k][1] !== v[1]\n\t\t) {\n\t\t\tcss.setProperty(k, ...v);\n\t\t}\n\t}\n\tfor (const k of Object.keys(oStyle)) {\n\t\tif (!style[k]) {\n\t\t\tcss.removeProperty(k);\n\t\t}\n\t}\n}\nfunction updateAttrs(\n\tel: HTMLElement | SVGElement,\n\tattrs: Record<string, string>,\n\toAttrs: Record<string, string>,\n) {\n\tfor (const k of Object.keys(attrs)) {\n\t\tconst v = attrs[k];\n\t\tif (!(k in oAttrs) || oAttrs[k] !== v) {\n\t\t\tel.setAttribute(k, v);\n\t\t}\n\t}\n\tfor (const k of Object.keys(oAttrs)) {\n\t\tif (!(k in attrs)) {\n\t\t\tel.removeAttribute(k);\n\t\t}\n\t}\n}\n\nfunction updateEvent(\n\tel: HTMLElement | SVGElement,\n\tevt: Record<string, Set<EventListener>>,\n\toEvt: Record<string, Set<EventListener>>,\n) {\n\n\tfor (const k of Object.keys(evt)) {\n\t\tconst set = evt[k];\n\t\tif (k in oEvt) {\n\t\t\tconst oSet = oEvt[k];\n\t\t\tfor (const f of set) {\n\t\t\t\tif (!oSet.has(f)) { el.addEventListener(k, f); }\n\t\t\t}\n\t\t\tfor (const f of oSet) {\n\t\t\t\tif (!set.has(f)) { el.removeEventListener(k, f); }\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const f of set) {\n\t\t\t\tel.addEventListener(k, f);\n\t\t\t}\n\t\t}\n\t}\n\tfor (const k of Object.keys(oEvt)) {\n\t\tif (k in evt) { continue; }\n\t\tfor (const f of oEvt[k]) {\n\t\t\tel.removeEventListener(k, f);\n\t\t}\n\t}\n}\n\nconst PropsMap = new WeakMap<Element, Props>();\nexport default function update(\n\tel: HTMLElement | SVGElement,\n\tprops: {[k: string]: any},\n) {\n\tconst old = PropsMap.get(el) || { attrs: {}, event: {} };\n\tconst { id,  classes, style, attrs, event } = getProps(props);\n\tPropsMap.set(el, { id, classes, style, attrs, event });\n\tif (id !== old.id) {\n\t\tif (typeof id === 'string') {\n\t\t\tel.id = props.id;\n\t\t} else {\n\t\t\tel.removeAttribute('id');\n\t\t}\n\t}\n\tupdateClass(el, classes, old.classes);\n\tupdateStyle(el.style, style, old.style);\n\tupdateAttrs(el, attrs, old.attrs);\n\tupdateEvent(el, event, old.event);\n\treturn el;\n}\n","\nimport update from './update';\nimport {\n\tIRender,\n\tNativeNode,\n\tNativeText,\n\tNativePlaceholder,\n\tNativeComponent,\n\tNativeShadow,\n\tNativeContainer,\n\tNativeElement,\n} from '@neep/core';\n\nconst render: IRender = {\n\ttype: 'html',\n\tisNode(v): v is NativeNode {\n\t\treturn v instanceof Node;\n\t},\n\tmount({target, class: className, style, tag}, parent) {\n\t\tif (!(\n\t\t\ttypeof tag === 'string' &&\n\t\t\t/^[a-z][a-z0-9]*(?:\\-[a-z0-9]+)?(?:\\:[a-z0-9]+(?:\\-[a-z0-9]+)?)?$/i.test(tag)\n\t\t)) {\n\t\t\ttag = 'div';\n\t\t}\n\t\tconst container = render.create(tag, { class: className, style });\n\t\tif (typeof target === 'string') {\n\t\t\ttarget = document.querySelector(target);\n\t\t}\n\t\tif (target instanceof Element) {\n\t\t\ttarget.appendChild(container as any);\n\t\t\tif (parent) {\n\t\t\t\treturn [container, parent.placeholder] as any;\n\t\t\t}\n\t\t\treturn [container, container];\n\t\t}\n\t\tif (parent !== render) {\n\t\t\tdocument.body.appendChild(container as any);\n\t\t\treturn [container, container] as any;\n\t\t}\n\t\treturn [container, container] as any;\n\t},\n\tunmount(container, node, removed) {\n\t\tif (container === node && removed) { return; }\n\t\t(container as any as Element).remove();\n\t},\n\tdrawContainer(container, node, {target, class: className, style, tag}, parent) {\n\t\trender.update(container as NativeElement, { class: className, style })\n\t\tif (typeof target === 'string') {\n\t\t\ttarget = document.querySelector(target);\n\t\t}\n\t\tif (parent !== render && !(target instanceof Element)) {\n\t\t\ttarget = document.body;\n\t\t}\n\t\tconst oldTarget = parent === render && container === node ? undefined : render.parent(node);\n\t\tif (oldTarget === target) {\n\t\t\treturn [container, node];\n\t\t}\n\t\tif (parent !== render) {\n\t\t\ttarget.appendChild(container);\n\t\t\treturn [container, node];\n\t\t}\n\t\tif (!oldTarget) {\n\t\t\tconst newNode = parent.placeholder();\n\t\t\tconst pNode = parent.parent(node);\n\t\t\tif (pNode) {\n\t\t\t\trender.insert(pNode, newNode as any, node);\n\t\t\t\trender.remove(node);\n\t\t\t}\n\t\t\treturn [container, newNode];\n\t\t}\n\t\tif (!target) {\n\t\t\tconst pNode = parent.parent(node);\n\t\t\tif (pNode) {\n\t\t\t\trender.insert(pNode, container, node);\n\t\t\t\trender.remove(node);\n\t\t\t}\n\t\t\treturn [container, container];\n\n\t\t}\n\t\ttarget.appendChild(node);\n\t\treturn [container, node];\n\t},\n\tdraw() {},\n\n\tcreate(tag, props) {\n\t\t// TODO: NS\n\t\t// 你好啊\n\t\treturn update(document.createElement(tag), props) as any;\n\t},\n\ttext(text: string): NativeText {\n\t\treturn document.createTextNode(text) as any;\n\t},\n\tplaceholder(): NativePlaceholder {\n\t\treturn document.createComment('') as any;\n\t},\n\tcomponent(): [NativeComponent, NativeShadow] {\n\t\tconst node = document.createElement('neep-component');\n\t\tnode.attachShadow({ mode: 'open' });\n\t\treturn [node, node.attachShadow({ mode: 'open' })] as any;\n\t},\n\n\tparent(node: NativeNode): NativeContainer | null {\n\t\treturn (node as any).parentNode as NativeContainer | null;\n\t},\n\tnext(node: NativeNode): NativeNode | null {\n\t\treturn (node as any).nextSibling as NativeContainer | null;\n\t},\n\tupdate(node, props): void {\n\t\tupdate(node as any, props);\n\t},\n\tinsert(\n\t\tparent: NativeContainer,\n\t\tnode: NativeNode,\n\t\tnext: NativeNode | null = null,\n\t): void {\n\t\t(parent as any).insertBefore(node, next);\n\t},\n\tremove(node: NativeNode): void {\n\t\tconst p = render.parent(node);\n\t\tif (!p) { return; }\n\t\t(p as any).removeChild(node);\n\t},\n};\n\nexport default render;\n"],"names":["recursive2iterable","list","Array","isArray","it","getId","v","String","undefined","getClass","set","Set","k","split","filter","Boolean","add","size","getStyle","style","css","Object","create","value","key","substr","replace","toLowerCase","stringify","data","isOn","Date","toISOString","RegExp","toString","JSON","getAttrs","props","attrs","name","getEvent","evt","f","getProps","id","class","className","classes","event","updateClass","el","oClasses","getAttribute","classList","forEach","c","delete","setAttribute","join","removeAttribute","updateStyle","oStyle","cssText","keys","removeProperty","setProperty","updateAttrs","oAttrs","updateEvent","oEvt","oSet","has","addEventListener","removeEventListener","PropsMap","WeakMap","update","old","get","render","type","isNode","Node","mount","target","tag","parent","test","container","document","querySelector","Element","appendChild","placeholder","body","unmount","node","removed","remove","drawContainer","oldTarget","newNode","pNode","insert","draw","createElement","text","createTextNode","createComment","component","attachShadow","mode","parentNode","next","nextSibling","insertBefore","p","removeChild"],"mappings":"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"}