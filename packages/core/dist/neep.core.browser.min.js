/*!
 * Neep v0.1.0-alpha.19
 * (c) 2019-2021 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("monitorable")):"function"==typeof define&&define.amd?define(["exports","monitorable"],t):t((e=e||self).Neep={},e.Monitorable)}(this,(function(e,t){"use strict";function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class r extends Error{constructor(e,t=""){super(t?`[${t}] ${e}`:e),n(this,"tag",void 0),this.tag=t}}function o(e,t,n){if(!e)throw"function"==typeof t&&(t=t()),new r(t,n)}let i;const s=Object.create(null);function c(e="",t=s.default){return"object"==typeof e?e:s[e]||t}function a(e){var t;e.monitorable,(t=e.renderer)&&(s[t.type]=t,i||(s.default||(s.default=t),!i&&t.nextFrame&&(s.default=t,i=t.nextFrame.bind(t))))}const u=Object.create(null);let d,l,h=1,f=!1;function p({name:e,create:t=(()=>({})),destroy:n,exec:r=(e=>e)}){const i=h++;return"function"==typeof n&&(u[i]=n),(...n)=>{if(o(d,`Function \`${e}\` can only be called within a cycle.`,"life"),f){const e=[],o=t(...n);d.push({id:i,value:o,list:e});const s=d;d=e;try{return r(o,...n)}finally{d=s}}const s=d.shift();o(s&&s.id===i,()=>"","life");const{value:c}=s,a=[...s.list],u=d;d=a;try{const e=r(c,...n);return o(!a.length,""),e}finally{d=u}}}function y(e,t,n,...r){const i=l;l=e;const s=function(e,t){const n={list:d,isInit:f};return t?(f=e,d=e?t:[...t],n):(f=!1,d=void 0,n)}(!e.created,t&&e.useData);try{const e=n(...r);return t&&o(f||!d||!d.length,"Inconsistent number of useService executions","life"),e}finally{l=i,c=s,({list:d,isInit:f}=c)}var c}function m(e){return o(l,`Function \`${e}\` can only be called within a cycle.`,"life"),l}function _(e,n,r){let{hooks:o}=r;if(!o)return()=>{};n=t.safeify(n);let i=o[e];return i||(i=new Set,o[e]=i),i.add(n),()=>i.delete(n)}function v(e,{hooks:t}){if(t)for(const n of t[e]||[])n()}function b(e,n,r){const o=m("withWatch");if("function"!=typeof e)return()=>{};let i;if(t.isValue(e))i=e.watch(n),r&&n(e,!1);else{const o=t.computed(e);i=o.watch((e,t)=>n(e(),t)),r&&n(o(),!1)}return _("beforeDestroy",()=>i(),o),i}function g(e,t,n){const r=m("withHook");if(!n||!r.created)return _(e,()=>t(),r)}const $=Symbol.for("renderer"),w=Symbol.for("name"),x=Symbol.for("components"),j=Symbol.for("props"),C=Symbol.for("$$$componentValue$$$"),S=Symbol.for("$$$objectType$$$"),R=Symbol.for("$$$deliverKey$$$"),D=Symbol.for("$$$deliverDefault$$$");function k(e){return"function"==typeof e&&"$$$objectType$$$SimpleComponent"===e[S]}function N(e){return"function"==typeof e&&"$$$objectType$$$ShellComponent"===e[S]}function T(e){return"function"==typeof e&&"$$$objectType$$$NativeComponentNode"===e[S]}function O(e){return"function"==typeof e&&"$$$objectType$$$RenderComponent"===e[S]}function A(e){return"function"==typeof e&&"$$$objectType$$$ContainerComponent"===e[S]}function E(e){return"function"==typeof e&&"$$$objectType$$$ElementComponent"===e[S]}function P(e){return"function"==typeof e&&"$$$objectType$$$DeliverComponent"===e[S]}function M(e){o(P(e),"The `deliver` is not a DeliverComponent.","deliver");const{delivered:t}=m("withDelivered"),n=t[e[R]];return void 0===n?e[D]:n}function V(e){return m("withRefresh").refresh(e)}function H(){return m("withParent").parent}function q(){return m("withChildren").getChildren()}function I(e){const t=m("withCallback");return(...n)=>y(t,void 0,e,...n)}function F(e,t,...n){const r="object"==typeof t&&t||{},o={[S]:"$$$objectType$$$Element",tag:e,props:r,children:n,key:void 0};return"n:key"in r&&(o.key=r["n:key"]),"n:slot"in r&&(o.slot=r["n:slot"]),o}const L="core:scopeslot",z="core:render",W="core:slot",B="core:container";function K(...e){return{[S]:"$$$objectType$$$Element",tag:"template",children:e}}function U(e){return!!e&&("object"==typeof e&&"$$$objectType$$$Element"===e[S])}function G(e,t){if(Object.is(e,t))return!0;if(!e)return!1;if(!t)return!1;if("object"!=typeof e)return!1;if("object"!=typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(let n=e.length-1;n>=0;n--)if(!G(e[n],t[n]))return!1;return!0}if(Array.isArray(t))return!1;if(!U(e))return!1;if(!U(t))return!1;if(e.tag!==t.tag)return!1;if(e.execed!==t.execed)return!1;if(e.inserted!==t.inserted)return!1;if(e.isDefault!==t.isDefault)return!1;if(e.key!==t.key)return!1;if(e.slot!==t.slot)return!1;const n=e.props,r=t.props;if(Object.is(n,r))return G(e.children,t.children);if(!n)return!1;if(!r)return!1;if("object"!=typeof n)return!1;if("object"!=typeof r)return!1;const o=new Set(Object.keys(n)),i=Object.keys(r);if(o.size!==i.length)return!1;for(const e of i){if(!o.has(e))return!1;if(n[e]!==r[e])return!1}return G(e.children,t.children)}function J(e){if(!U(e))return!1;const{tag:t}=e;return"string"==typeof t&&t.toLowerCase()===z}function Q(...e){}function X(e,t){return{...e,id:0}}function Y(e){}function Z(e){return!1===e||null==e?null:U(e)?e:{key:e,props:{value:e},children:[]}}function ee(e){return X({tag:null,node:e.createPlaceholder()})}function te(e,t,n){if(!n)return ee(e);const{proxy:r}=n;return r.mount(t),X({...n,node:void 0,proxy:r})}function ne(e,t,n){return n.length?n.map(n=>te(e,t,n)):[ee(e)]}function re(e,t,n){return n.length?n.map(n=>Array.isArray(n)?ne(e,t,n):te(e,t,n)):[ee(e)]}function oe(e,t){if(t)if(Array.isArray(t))t.forEach(t=>oe(e,t));else if(t.proxy){const{proxy:e}=t;e.unmount()}else{if(t.node){const{node:n}=t;e.removeNode(n)}oe(e,t.children)}}function*ie(e){if(Array.isArray(e)){for(const t of e)yield*ie(t);return}const{node:t,proxy:n}=e;t?yield t:n&&(yield*ie(n.tree))}function se(e){return Array.isArray(e)?se(e[0]):e.node?e.node:se(e.proxy.tree)}function ce(e,t,n){const r=se(n);if(!r)return t;const o=e.getParent(r);if(!o)return t;for(const n of ie(t))e.insertNode(o,n,r);return oe(e,n),t}function ae(e){return Array.isArray(e)?ae(e[e.length-1]):e.node?e.node:ae(e.proxy.tree)}function ue(e,t,n,r){if(!n){if(Array.isArray(r)){if(1===r.length&&null===r[0].tag)return r[0]}else if(null===r.tag)return r;return ce(e,ee(e),r)}if(Array.isArray(r)){const o=r.findIndex(e=>e.tag===n.tag&&e.proxy===n.proxy);if(o<0)return ce(e,te(e,t,n),r);const i=r;[r]=r.splice(o,1),oe(e,i)}if(n.proxy){const{proxy:o}=n;return o!==r.proxy?ce(e,te(e,t,n),r):X({...n,node:void 0,proxy:o},r.id)}return r.proxy||n.tag!==r.tag?ce(e,te(e,t,n),r):void 0===n.tag?r:ce(e,te(e,t,n),r)}function de(e,t,n,r){if(!n.length){return[ce(e,ee(e),r)]}Array.isArray(r)||(r=[r]);const o=[],i=[...r],s=new Map;for(const r of n){const n=i.findIndex(e=>e.tag===r.tag&&e.key===r.key&&e.proxy===r.proxy);if(n>=0){const c=i[n],a=ue(e,t,r,c);s.set(c,a),o.push(a),i.splice(n,1)}else{const n=te(e,t,r);o.push(n)}}if(!s.size)return ce(e,o,i);oe(e,i);const c=ae((r=r.filter(e=>s.has(e))).map(e=>s.get(e)).filter(Boolean)),a=e.getParent(c);if(!a)return o;let u=e.nextNode(c);for(let t=o.length-1;t>=0;t--){const n=o[t],i=r.findIndex(e=>s.get(e)===n);if(i>=0)for(const e of r.splice(i))s.delete(e);else for(const t of ie(n))e.insertNode(a,t,u);u=se(n)||u}return o}function le(e,t,n,r){return r?function(e,t,n,r){if(0===n.length)return ce(e,re(e,t,[]),r);let o=0,i=Math.min(n.length,r.length);const s=[];for(;o<i;o++){const i=n[o];Array.isArray(i)?s.push(de(e,t,i,r[o])):s.push(ue(e,t,i,r[o]))}if(i=Math.max(n.length,r.length),r.length>o)for(;o<i;o++)oe(e,r[o]);if(n.length>o){const r=ae(s[s.length-1]),c=e.getParent(r),a=e.nextNode(r);for(;o<i;o++){const r=n[o],i=Array.isArray(r)?ne(e,t,r):te(e,t,r);if(s.push(i),c)for(const t of ie(i))e.insertNode(c,t,a)}}return s}(e,t,n,r):re(e,t,n)}let he;function fe(e){he=e}function pe(e){he?he.push(e):e()}class ye{constructor(e,t,r,o,i,s){n(this,"tag",void 0),n(this,"attrs",void 0),n(this,"renderer",void 0),n(this,"labels",void 0),n(this,"parentProxy",void 0),n(this,"delivered",void 0),n(this,"created",!1),n(this,"destroyed",!1),n(this,"mounted",!1),n(this,"unmounted",!1),n(this,"tree",[]),n(this,"container",void 0),n(this,"componentRoot",void 0),n(this,"originalTag",void 0),n(this,"__executed_destroy",!1),n(this,"__mountOptions",null),n(this,"__cancelDrawMonitor",void 0),n(this,"__executed_unmounted",!1),this.originalTag=t,this.tag=r,this.renderer=e,this.attrs=o,this.parentProxy=i,this.delivered=s||(null==i?void 0:i.delivered)||Object.create(null)}update(e,t){this.attrs=e,this._update(e,t)}destroy(){return!this.__executed_destroy&&(this.__executed_destroy=!0,this.callHook("beforeDestroy"),this._destroy(),this.callHook("destroyed"),this.destroyed=!0,!0)}mount(e){if(this.__executed_destroy)return!1;if(!e)return!1;if(this.__mountOptions)return!1;this.__mountOptions=e,this.callHook("beforeMount");const n=t.exec(e=>e&&this.requestDraw(),()=>{const t=this._mount(e);this.__mountOptions=t||e,this.mounted=!0});return this.__cancelDrawMonitor=n.stop,pe(()=>this.callHook("mounted")),!0}unmount(){return!!this.mounted&&(!this.__executed_unmounted&&(this.__executed_unmounted=!0,this.callHook("beforeUnmount"),this._unmount(),this.callHook("unmounted"),this.unmounted=!0,!0))}redraw(){if(this.__executed_destroy)return;if(!this.mounted)return;const e=this.__mountOptions;if(!e)return;this.__cancelDrawMonitor&&this.__cancelDrawMonitor(),this.callHook("beforeDraw");const n=t.exec(e=>e&&this.requestDraw(),()=>this._redraw(e));this.__cancelDrawMonitor=n.stop,pe(()=>this.callHook("drawn"))}}class me extends ye{constructor(e,t,r,o,i,s){super(i.renderer,e,t,r,i,s),n(this,"container",void 0),n(this,"componentRoot",void 0),this.container=i.container,this.componentRoot=i.componentRoot}requestDraw(){this.mounted&&(this.destroyed||this.container.markDraw(this))}callHook(e){}}let _e=0;const ve=new Set;function be(e){return!(_e<=0)&&(ve.add(e),!0)}function ge(){if(_e>0)return;const e=[...ve];ve.clear(),e.forEach(e=>e.refresh())}function $e(e,t){if(t)return async function(e){try{return _e++,await e()}finally{_e--,ge()}}(e);try{return _e++,e()}finally{_e--,ge()}}const we=Object.create(null);let xe=0;function je({name:e,create:t=(()=>({})),destroy:n,exec:r}){const o=xe++;return"function"==typeof n&&(we[o]=n),"function"==typeof r?(...n)=>{const i=m(e),{withData:s,destroyed:c,isSimple:a,isShell:u}=i;return o in s||(s[o]=t({destroyed:c,isSimple:a,isShell:u})),r(s[o],{destroyed:c,isSimple:a,isShell:u},...n)}:()=>{const n=m(e),{withData:r}=n;if(!(o in r)){const{destroyed:e,isSimple:i,isShell:s}=n;r[o]=t({destroyed:e,isSimple:i,isShell:s})}return r[o]}}function Ce(e){return function(t,...n){return y(e,void 0,t,...n)}}function Se(e,t,n,r=!1){const o=[];for(const i of t){if(Array.isArray(i)){const t=Object.create(null);o.push(Se(e,i,t,r));for(const e of Reflect.ownKeys(t))e in n?n[e].push(t[e]):n[e]=[t[e]];continue}if(U(i)&&void 0===i.slot&&(k(i.tag)&&i.execed||"template"===i.tag)){const t=Object.create(null);o.push(Se(e,i.children,t,r));for(const e of Reflect.ownKeys(t)){const r={...i,children:t[e]};e in n?n[e].push(r):n[e]=[r]}continue}if(r){if(e.isNode(i)){o.push(i);continue}if(!U(i)){o.push(i);continue}if(i.tag!==z&&"template"!==i.tag){o.push(i);continue}}const t=U(i)&&i.slot||"default",s=U(i)?{...i,slot:void 0,props:{...i.props,"n:slot":void 0}}:i;t in n?n[t].push(s):n[t]=[s]}return o}function Re(e,n,r){return Reflect.defineProperty(e,n,{get:()=>(t.markRead(e,n),r),enumerable:!0,configurable:!0}),t.markChange(e,n),r}function De(e,t,n){if(!t){const t=Object.create(null);for(const n of Reflect.ownKeys(e))t[n]=e[n];return t}for(const n of Reflect.ownKeys(t))n in e||Re(t,n);if(!n){for(const n of Reflect.ownKeys(e)){Re(t,n,e[n])}return t}for(const r of Reflect.ownKeys(e)){const o=e[r];G(o,n[r])||Re(t,r,o)}return t}function ke(e,n){return e.map(e=>{if(Array.isArray(e))return ke(e,n);if(!U(e))return e;if(e.tag!==z)return{...e,slot:void 0};const{children:r}=e;if(1!==(null==r?void 0:r.length))return r;const[o]=r;return t.isValue(o)||"function"!=typeof o?r:o(n)})}function Ne(e,t,n){return n||t in e?e[t]:Re(e,t)}function Te(e,t=!1){function n(n="default",r={}){const o=Ne(e,n,t);return{[S]:"$$$objectType$$$Element",tag:L,children:o?ke(o,r):[],inserted:!0,slot:n,isDefault:!o}}return n.has=(n="default")=>Boolean(Ne(e,n,t)),n}function Oe(e,n=[]){const r=(t,n,r)=>$e(()=>{const o=Boolean(null==r?void 0:r.cancelable),{target:i}=e;let s=!0;const c={get target(){return i},get cancelable(){return o},get defaultPrevented(){return s},get prevented(){return s},preventDefault(){s=!1},prevent(){s=!1}},a=e.events[t];if(!a)return s;for(const e of a)e(n,c);return s});return r.omit=(...t)=>Oe(e,[...n,...t]),Reflect.defineProperty(r,"names",{get:()=>(t.markRead(Oe,"names"),[...e.names].filter(e=>!n.includes(e))),configurable:!0}),r}class Ae{get names(){return t.markRead(this,"names"),[...this._names]}constructor(){n(this,"_names",new Set),n(this,"events",Object.create(null)),n(this,"emit",Oe(this)),n(this,"on",void 0),n(this,"target",void 0),n(this,"__propsEvents",Object.create(null)),n(this,"__eventMap",Object.create(null)),n(this,"__propsEmitEvents",Object.create(null)),n(this,"__propsEmitEvent",void 0);const e=this._names,r=this.events;this.on=(n,o)=>{var i;function s(e,n){try{o(e,n)}catch(e){t.printError(e)}}let c=r[n];(null===(i=c)||void 0===i?void 0:i.size)?c.add(s):(c=new Set,c.add(s),r[n]=c,e.add(n),t.markChange(this,"names"));let a=!1;return()=>{a||(a=!0,c&&(c.delete(s),c.size||(e.delete(n),t.markChange(this,"names"))))}}}updateInProps(e){const t=this.__propsEvents,n=new Set(Object.keys(t));for(const[r,o]of function*(e){if(!e)return;for(const t of Object.keys(e)){const n=e[t];if("function"!=typeof n)continue;if("on:"!==t.substr(0,3))continue;const r=t.substr(3);r&&(yield[r,n])}}(e)){if(n.has(r)){n.delete(r);const[e,i]=t[r]||[];if(e===o)continue;i&&i()}t[r]=[o,this.on(r,o)]}for(const e of n){const n=t[e];n&&(n[1](),delete t[e])}const r=this.__eventMap,o=new Set(Object.keys(r));for(const[t,n]of function*(e){if(!e)return;const t=e["n:on"];if(!t)return;if("object"==typeof t)return;for(const t of Object.keys(e)){const n=e[t];"function"==typeof n&&(yield[t,n])}}(e)){if(o.has(t)){o.delete(t);const[e,i]=r[t]||[];if(e===n)continue;i&&i()}r[t]=[n,this.on(t,n)]}for(const e of o){const t=r[e];t&&(t[1](),delete r[e])}const i=this.__propsEmitEvents,s=function(e){if(!e)return;let t=null==e?void 0:e["n:on"];if("function"!=typeof t)return;return t}(e);if(s!==this.__propsEmitEvent){this.__propsEmitEvent=s;for(const e of[...Object.keys(i)]){const t=i[e];t&&(t(),delete i[e])}if(!s)return;const{names:e}=s;if(!Array.isArray(e))return;for(const t of e)i[t]=this.on(t,e=>s(t,e));return}if(!s)return;const c=new Set(Object.keys(i)),a=s.names||[];for(const e of a)e&&(c.delete(e),c.has(e)||(i[e]=this.on(e,t=>s(e,t))));for(const e of c){const t=i[e];t&&(t(),delete i[e])}}}function Ee(e){const t=new Ae;return t.updateInProps(e),t.emit}function Pe(...e){return e.filter(Boolean)}function Me(e){return Array.isArray(e)?e:U(e)?"template"!==e.tag?[e]:e.children:[e]}const Ve=Object.create(null);function He(e,t){Ve[e]=t}function qe(e,t,n){if(!e)return null;if("string"!=typeof e)return e;if(/^core:/i.test(e)){let t=e.toLowerCase();return t===B||(t===L||t===z)?t:t===W?n?"slot":L:"template"}if("template"===e)return e;if("slot"===e)return e;for(const n of t){const t=n[e];if(t)return t}return Ve[e]||e}function Ie(e,t){if(1!==e.length)return e;const[n]=e;return"function"!=typeof n?e:Me(n(t))}function Fe(e,t,n,r,o){const i=function(e,t){const n=Object.create(null);return Se(e.renderer,t,n),De(n)}(e,o),s=function(e){return{isShell:!1,isSimple:!0,created:!1,destroyed:!0,delivered:e.delivered,withData:{},refresh:e.refresh,parent:e.simpleParent,getChildren:()=>[]}}(e),c=ze(e,Me(y(s,void 0,n,{...t.props},{by:Ce(s),slot:Te(i,!0),childNodes:()=>o,emit:Ee(t.props)})),i,Pe(...r,n[x]),!1,!0);return{...t,tag:n,execed:!0,children:Array.isArray(c)?c:[c]}}function Le(e,n,r,o,i,s){var c;if(Array.isArray(e))return e.map(e=>Le(e,n,r,o,i,s));if(!U(e))return e;if(e.tag===L&&e.inserted)return e;const{children:a}=e,u=qe(e.tag,o,i);if(k(u))return e.execed?e:Fe(n,e,u,o,a.map(e=>Le(e,n,r,o,i,s)));if(u===z){const s=function(e,n,r,o,i){if(1!==n.length)return null;const[s]=n;if(t.isValue(s)||"function"!=typeof s)return null;const{slotRenderFnList:c}=e,a=c.get(s);if(a)return a;const u=function(...t){return ze(e,s.call(this,...t),r,o,i,!1)};return c.set(s,u),u}(n,a,r,o,i);if(s)return{...e,children:[s]}}if(u!==L)return{...e,tag:u,children:a.map(e=>Le(e,n,r,o,i,s))};const{props:d}=e,l=(null==d?void 0:d.argv)||{},h=(null===(c=e.props)||void 0===c?void 0:c.name)||"default",f=s||h in r?r[h]:Re(r,h);return{[S]:"$$$objectType$$$Element",props:d,key:e.key,tag:L,inserted:!0,slot:h,isDefault:!f,children:f?ke(f,l):Ie(a,l).map(e=>Le(e,n,r,o,i,s))}}function ze(e,n,r,o,i,s){return $e(()=>t.postpone(()=>Le(n,e,r,o,i,s)))}function We(e,t,n,r,o=e.tag[x]||null){return ze({renderer:e.renderer,refresh:n,slotRenderFnList:t,delivered:e.delivered,simpleParent:e.entity},Me(r),e.slots,Pe(o),Boolean(e.isNative),!1)}function Be(e){return null==e?null:e instanceof Date?e.toISOString():(RegExp,String(e))}class Ke extends me{get content(){return this.tree}set value(e){const n=e!==this.__value;this.__value=e,n&&t.markChange(this,"value")}get value(){t.markRead(this,"value");let e=this.__value;for(;t.isValue(e);)e=e();return e}constructor(e,r){super(null,null,e,[],r),n(this,"__value",void 0),n(this,"text",void 0),n(this,"isValue",void 0),n(this,"__nodes",void 0),n(this,"src",void 0),n(this,"__render",void 0),n(this,"__refreshing",!1),n(this,"__needRefresh",!1);const{value:o}=e;this.__value=o;const i=Object.create(null),s={renderer:this.renderer,refresh:()=>this.refresh(),slotRenderFnList:new WeakMap,delivered:this.delivered,simpleParent:void 0};this.__render=t.monitor(e=>e&&this.refresh(),()=>{let{value:e}=this;if(U(e)||Array.isArray(e))return this.__nodes=_t(this,ze(s,U(t=e)?"template"!==t.tag?[t]:t.children:[t],i,[],!1,!1),this.__nodes),!0;var t;if(this.__nodes)ft(this.__nodes),this.__nodes=void 0;else if(this.src===e)return!1;return this.src=e,!0}),this.created=!0,this.refresh()}refresh(){if(this.destroyed)return;if(this.__needRefresh=!0,!this.created)return;if(this.__refreshing)return;this.__refreshing=!0;let e=!1;for(;this.__needRefresh&&!be(this);)if(this.__needRefresh=!1,e=this.__render()||e,this.destroyed)return;this.__refreshing=!1,e&&(be(this)||this.mounted&&(this.destroyed||this.unmounted||this.requestDraw()))}_update({value:e}){this.value=e}_destroy(){this.__render.stop();const{__nodes:e}=this;e&&ft(e)}_mount(e){const{renderer:t,__nodes:n,src:r}=this;if(n)return void(this.tree=le(t,e,n));if(t.isNode(r))return void(this.tree=[X({node:r})]);const o=Be(r),i="string"==typeof o?X({node:t.createText(o)}):ee(t);this.tree=[i]}_redraw(e){const{renderer:t,__nodes:n,src:r}=this;if(n)return void(this.tree=le(t,e,n,this.tree));if(t.isNode(r))return void(this.tree=[X({node:r})]);const o=Be(r),i="string"==typeof o?X({node:t.createText(o)}):ee(t);this.tree=ce(t,[i],this.tree)}_unmount(){const{renderer:e,tree:t}=this;oe(e,t)}}class Ue extends me{get content(){return this.tree}constructor(e,r,o,i,s){super(e,r,o,i,s,Object.create(s.delivered)),n(this,"__valueObject",void 0),n(this,"__nodes",void 0);const{value:c}=o;this.__valueObject=c,Reflect.defineProperty(this.delivered,r[R],{configurable:!0,enumerable:!0,get:()=>(t.markRead(this,"value"),this.__valueObject)}),this.__nodes=_t(this,i),this.created=!0}_update({value:e},n){this.__valueObject!==e&&(this.__valueObject=e,t.markChange(this,"value")),this.__nodes=_t(this,n,this.__nodes),this.requestDraw()}_destroy(){ft(this.__nodes)}_mount(e){this.tree=le(this.renderer,e,this.__nodes)}_redraw(e){const{renderer:t,__nodes:n,tree:r}=this;this.tree=le(t,e,n,r)}_unmount(){oe(this.renderer,this.tree)}}class Ge extends me{get content(){return this.tree}constructor(e,t,r){super(e,e,{},t,r),n(this,"__nodes",void 0),this.__nodes=_t(this,t)}_update(e,t){this.__nodes=_t(this,t,this.__nodes),this.requestDraw()}_destroy(){ft(this.__nodes)}_mount(e){this.tree=le(this.renderer,e,this.__nodes)}_redraw(e){this.tree=le(this.renderer,e,this.__nodes,this.tree)}_unmount(){oe(this.renderer,this.tree)}}function Je(e,t){const n=new Set(Object.keys(t));for(const r in e){if("data:"!==r.substr(0,5))continue;const o=r.substr(5);o&&(n.delete(o),t[o]=e[o])}const r=e["n:data"];if(r&&"object"==typeof r)for(const e in r)e&&(n.delete(e),t[e]=r[e]);for(const e of n)delete t[e]}class Qe extends ye{get exposed(){return this.__exposed}setExposed(e){if(this.destroyed)return;const t=this.__ref;if("function"!=typeof t)return void(this.__exposed=e);const n=this.__exposed;this.__exposed=e,t(e,n,this.entity)}constructor(e,t,r,o,i,s){super(e,t,r,o,i,s),n(this,"__exposed",void 0),n(this,"__ref",void 0),n(this,"events",void 0),n(this,"entity",void 0),n(this,"data",Object.create(null)),Je(o,this.data);const c=new Ae,a=this.createEntity(c);c.target=a,this.entity=a,this.events=c;const u=o["n:ref"];"function"==typeof u&&(this.__ref=u,u(void 0,void 0,a,!0))}update(e,t){Je(e,this.data);const n=e["n:ref"],r=this.__ref;n!==r&&("function"==typeof n?n(this.__exposed):r&&(this.__ref=void 0)),super.update(e,t)}destroy(){if(!super.destroy())return!1;const e=this.__ref;return"function"!=typeof e||e(void 0,this.__exposed,this.entity,!1),!0}}class Xe extends Qe{constructor(e,t,r,o,i){super(i.renderer,e,t,r,i),n(this,"container",void 0),n(this,"componentRoot",void 0),n(this,"props",void 0),n(this,"__nodes",void 0),n(this,"node",void 0),n(this,"content",[]),n(this,"__elementTagData",void 0),this.container=i.container,this.componentRoot=i.componentRoot,this.props=r,this.events.updateInProps(r),this.__nodes=_t(this,o),this.__elementTagData="string"==typeof t?t:t[C]}requestDraw(){this.mounted&&(this.destroyed||this.container.markDraw(this))}callHook(e){}createEntity(e){const t={data:{configurable:!0,value:this.data},exposed:{configurable:!0,get:()=>this.exposed},on:{configurable:!0,value:e.on},emit:{configurable:!0,value:e.emit}};return Object.create(null,t)}_update(e,t){this.props=e,this.events.updateInProps(e),this.__nodes=_t(this,t,this.__nodes),this.requestDraw()}_destroy(){this.destroyed||(this.destroyed=!0,ft(this.__nodes))}_mount(e){if(this.node)return;const{renderer:t,__elementTagData:n,props:r,__nodes:o}=this,i=t.createElement(n,r,e);if(!i)return;this.node=i,this.setExposed(i);const s=t.getMountOptions(i,e)||e;if(o){const e=le(t,s,o);this.content=e;for(const n of ie(e))t.insertNode(i,n)}return this.tree=[X({node:i})],t.updateProps(i,n,r,this.events.emit,s),s}_redrawChildren(e){const{renderer:t,__nodes:n,content:r,node:o}=this;if(o)if(!n.length&&r.length)oe(t,r),this.content=[];else if(n.length&&r.length)this.content=le(t,e,n,r);else if(n.length&&!r.length){const r=le(t,e,n);this.content=r;for(const e of ie(r))t.insertNode(o,e)}}_redraw(e){this._redrawChildren(e);const{renderer:t,__elementTagData:n,node:r,props:o}=this;r&&t.updateProps(r,n,o||{},this.events.emit,e)}_unmount(){const{renderer:e,tree:t,node:n}=this;n&&(e.removeNode(n),oe(e,t))}}function Ye(e){const t={created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted}};return Object.create(null,t)}class Ze extends Qe{constructor(e,t,r,o,i){var s;super(o.renderer,e,t,r,o),n(this,"contextData",void 0),n(this,"parentComponentProxy",void 0),n(this,"children",new Set),n(this,"__refreshing",!1),n(this,"__needRefresh",!1),n(this,"__delayedRefresh",0),n(this,"_nodes",[]);const c=this;this.parentComponentProxy=o.componentRoot;const a=null===(s=o.componentRoot)||void 0===s?void 0:s.entity;this.contextData={isShell:i,isSimple:!1,get created(){return c.created},get destroyed(){return c.destroyed},delivered:this.delivered,withData:{},info:i?void 0:Ye(this),hooks:i?void 0:{},useData:i?void 0:[],refresh:this.refresh.bind(this),parent:a,getChildren:()=>[...this.children].map(e=>e.exposed)}}get needRefresh(){return this.__needRefresh}refresh(e){if("function"==typeof e)try{return this.__delayedRefresh++,e()}finally{this.__delayedRefresh--,this.__delayedRefresh<=0&&this.refresh()}if(this.destroyed)return;if(this.__needRefresh=!0,!this.created)return;if(this.__refreshing)return;let t;for(this.__refreshing=!0;!be(this)&&!this.__delayedRefresh&&this.__needRefresh;)if(this.__needRefresh=!1,t=this._render(),this.destroyed)return;this.__refreshing=!1,this.destroyed||this.__delayedRefresh||t&&(be(this)||(this._nodes=_t(this,t,this._nodes),this.mounted&&(this.unmounted||this.requestDraw())))}_destroy(){this._stopRender();const{contextData:e}=this;!function(e){const t=Object.keys(e);for(const n of t){if(!(n in we))continue;(0,we[n])(e[n])}}(e.withData),function e(t){if(t)for(const{id:n,value:r,list:o}of t){if(e(o),!(n in u))continue;(0,u[n])(r)}}(e.useData),ft(this._nodes)}}class et extends Ze{get content(){return this.tree}requestDraw(){this.mounted&&(this.destroyed||this.container.markDraw(this))}callHook(e){}createEntity(e){const t={data:{configurable:!0,value:this.data},exposed:{configurable:!0,value:void 0},on:{configurable:!0,value:e.on},emit:{configurable:!0,value:e.emit}};return Object.create(null,t)}constructor(e,r,o,i,s){super(e,r,o,s,!0),n(this,"props",void 0),n(this,"childNodes",void 0),n(this,"src",void 0),n(this,"slots",Object.create(null)),n(this,"lastSlots",void 0),n(this,"_render",void 0),n(this,"container",void 0),n(this,"componentRoot",void 0),n(this,"_stopRender",void 0),this.container=s.container,this.componentRoot=s.componentRoot,this.props=o,this.childNodes=i;const{slots:c}=this,{delivered:a}=this,u=this.events,{contextData:d}=this,l={by:Ce(this.contextData),slot:Te(c),childNodes:()=>this.childNodes,emit:u.emit},h={renderer:this.renderer,refresh:e=>{this.refresh(e)},slotRenderFnList:new WeakMap,delivered:a,simpleParent:void 0},f=t.monitor(e=>e&&this.refresh(),()=>{const e={...this.props};u.updateInProps(e);const t=y(d,void 0,r,e,l);return ze(h,function(e){return Array.isArray(e)?e:U(e)?"template"!==e.tag?[e]:e.children:[e]}(t),c,[],!1,!1)});this._stopRender=f.stop,this._render=f,this.created=!0,this.refresh(),this._nodes=_t(this,this._render())}_update(e,t){this.props=e;const n=Object.create(null);Se(this.renderer,t,n),De(n,this.slots,this.lastSlots),this.lastSlots=n,this.childNodes=t,this.refresh()}_mount(e){this.tree=le(this.renderer,e,this._nodes)}_redraw(e){this.tree=le(this.renderer,e,this._nodes,this.tree)}_unmount(){oe(this.renderer,this.tree)}}class tt extends me{get content(){return this.tree}constructor(e,t,r){super(L,L,{},[],t),n(this,"__nodes",void 0),this.__nodes=_t(this,e)}_update(e,t){this.mounted&&(this.destroyed||(this.__nodes=_t(this,t,this.__nodes),this.requestDraw()))}_destroy(){ft(this.__nodes)}_mount(e){this.tree=le(this.renderer,e,this.__nodes)}_redraw(e){this.tree=le(this.renderer,e,this.__nodes,this.tree)}_unmount(){oe(this.renderer,this.tree)}}const nt=new Set([":","@","#","*","!","%","^","~","&","?","+",".","(",")","[","]","{","}","<",">"]);function rt(e){return"string"!=typeof e||!nt.has(e[0])&&("n:"!==e.substr(0,2)&&"on:"!==e.substr(0,3))}class ot extends Ze{callHook(e){v(e,this.contextData)}constructor(e,r,o,i,s){super(e,r,o,s,!1),n(this,"isNative",!1),n(this,"container",void 0),n(this,"componentRoot",void 0),n(this,"emit",void 0),n(this,"on",void 0),n(this,"components",Object.create(null)),n(this,"props",void 0),n(this,"propsDefined",void 0),n(this,"slots",Object.create(null)),n(this,"lastSlots",void 0),n(this,"nativeNodes",void 0),n(this,"_render",void 0),n(this,"_stopRender",void 0),n(this,"childNodes",[]),this.container=s.container,this.componentRoot=this;const{events:c}=this;this.emit=c.emit,this.on=c.on,Object.assign(this.components,r[x]);const a=r[j];Array.isArray(a)?(this.propsDefined=a,this.props=t.createObject(a,null)):this.props=Object.create(null),this._init(),this.callHook("beforeCreate"),this._update(o,i);const u={by:Ce(this.contextData),slot:Te(this.slots),expose:e=>this.setExposed(e),childNodes:()=>this.childNodes,emit:this.emit},{render:d,nodes:l,stopRender:h}=this._initRender(u);this._render=d,this._stopRender=h,this._nodes=_t(this,l),this.callHook("created"),this.created=!0,this.needRefresh&&this.refresh()}createEntity(e){return function(e,t){var n;const r={data:{configurable:!0,value:e.data},exposed:{configurable:!0,get:()=>e.exposed},parent:{configurable:!0,value:null===(n=e.parentComponentProxy)||void 0===n?void 0:n.entity},component:{configurable:!0,value:e.tag},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},callHook:{configurable:!0,value(t){v(t,e.contextData)}},setHook:{configurable:!0,value:(t,n)=>_(t,n,e.contextData)},on:{configurable:!0,value:t.on},emit:{configurable:!0,value:t.emit}};return Object.create(null,r)}(this,e)}_update(e,n){this.destroyed||(this.childNodes=n,$e(()=>t.postpone(()=>function(e,t,n){const{props:r,isNative:o}=e,i=new Set(Object.keys(t).filter(rt));if(e.propsDefined){e.propsDefined.forEach(e=>i.add(e));for(const e of Object.keys(r))rt(e)&&!i.has(e)&&delete r[e];for(const e of i)r[e]=t[e]}else{let n=!1;for(const e of Object.keys(r))rt(e)&&!i.has(e)&&(n=!0,delete r[e]);for(const e of i)e in r&&[e]===t[e]||(r[e]=t[e],n=!0);n&&e.refresh()}e.events.updateInProps(t);const s=Object.create(null),c=Se(e.renderer,n,s,o);De(s,e.slots,e.lastSlots),e.lastSlots=s,o&&(e.nativeNodes=_t(e,c,e.nativeNodes),e.mounted&&e.requestDraw())}(this,e,n))))}requestDraw(){this.container.markDraw(this)}}function it(e,n){const{tag:r,props:o,entity:i,contextData:s}=e,c=r[C],a="function"!=typeof c?()=>K(...e.childNodes):()=>y(s,i,c,o||{},n),u={renderer:e.renderer,refresh:t=>e.refresh(t),slotRenderFnList:new WeakMap,delivered:e.delivered,simpleParent:e.entity},d=e.tag[x],l=d?[d]:[],h=t.monitor(t=>t&&e.refresh(),()=>{return ze(u,(t=a(),Array.isArray(t)?t:U(t)?"template"!==t.tag?[t]:t.children:[t]),e.slots,l,!1,!1);var t});return{nodes:h(),render:h,stopRender:()=>h.stop()}}class st extends ot{constructor(...e){super(...e),n(this,"nativeNodes",void 0),n(this,"childNodes",[])}get content(){return this.tree}_init(){}_initRender(e){return it(this,e)}requestDraw(){this.container.markDraw(this)}_redraw(e){const{renderer:t,_nodes:n}=this;this.tree=le(t,e,n,this.tree)}_mount(e){const{renderer:t,_nodes:n}=this;this.tree=le(t,e,n)}_unmount(){const{renderer:e}=this;oe(e,this.tree)}}function ct(e,n,r){const o=new WeakMap,i=t.monitor(t=>t&&e.refresh(),()=>We(e,o,t=>e.refresh(t),n(),r));return{nodes:i(),render:i,stopRender:()=>i.stop()}}class at extends ot{constructor(...e){super(...e),n(this,"content",[]),n(this,"native",void 0),n(this,"shadowTree",[]),n(this,"nativeTree",[]),n(this,"_shadow",void 0),n(this,"childNodes",[]),n(this,"__nativeTreeNountOptions",void 0)}_init(){var e,t;if(!T(this.tag))return;const n=null===(e=(t=this.renderer).createComponent)||void 0===e?void 0:e.call(t);n&&([this.native,this._shadow]=n)}_initRender(e){return function(e,n){const{tag:r,props:o,entity:i,contextData:s}=e,c=()=>y(s,i,r,o,n),a=t=>{t&&e.refresh()},u=t.exec(a,{resultOnly:!0},c);if("function"==typeof u)return ct(e,u);if(J(u)){const{children:t}=u;if(1===(null==t?void 0:t.length)&&"function"==typeof t[0])return ct(e,t[0])}if(U(u)&&O(u.tag)){const{tag:t}=u,r=t[C];if("function"==typeof r)return ct(e,()=>r(u.props||{},n),u.tag[x]||null)}const d=t=>{e.refresh(t)},l=new WeakMap,h=t.monitor(a,()=>We(e,l,d,c()));return{nodes:t.exec(a,()=>We(e,l,d,u),{resultOnly:!0}),render:h,stopRender:()=>h.stop()}}(this,e)}requestDraw(){this.container.markDraw(this)}_mount(e){const{nativeNodes:t,renderer:n,_shadow:r,native:o,_nodes:i}=this;if(!o||!t||!r)return void(this.tree=this.content=le(n,e,i));this.tree=[X({node:o})];const s=n.getMountOptions(r,e)||e;this.content=le(n,s,i);for(const e of ie(this.content))n.insertNode(r,e);const c=n.getMountOptions(o,e)||e;this.nativeTree=le(n,c,t);for(const e of ie(this.nativeTree))n.insertNode(o,e);return this.__nativeTreeNountOptions=c,s}_redraw(e){const{nativeNodes:t,renderer:n,__nativeTreeNountOptions:r,_nodes:o}=this;this.content=le(n,e,o,this.content),t&&r?this.nativeTree=le(n,r,t,this.nativeTree):this.tree=this.content}_unmount(){const{renderer:e,nativeTree:t}=this;oe(e,this.tree),t&&oe(e,t)}}const ut=[];function dt(e){ut.push(e)}function lt(e,{tag:t,props:n,children:r,isDefault:o}){if(t===B)return new Dt(t,null,n,r,e);if(t===L)return new tt(r,e,o);if("template"===t)return new Ge(t,r,e);if("string"==typeof t)return"core:"===t.substr(0,5)?new Ge(t,r,e):new Xe(t,t,n||{},r,e);const i=function(e){for(const t of ut){const n=t(e);if("function"==typeof n)return n}return"function"==typeof e?e:null}(t);return"function"!=typeof i?new Ge(t,r,e):N(i)?new et(t,i,n||{},r,e):P(i)?new Ue(t,i,n||{},r,e):A(i)?new Dt(t,i,n,r,e):E(i)?new Xe(t,i,n||{},r,e):k(i)?new Ge(t,r,e):O(i)?new st(t,i,n||{},r,e):new at(t,i,n||{},r,e)}function ht(e,t){if(!t)return null;if(!t.tag){const{key:n,props:r}=t;return{key:n,props:r,proxy:new Ke(t.props||{},e)}}const{tag:n,key:r,props:o}=t;return{tag:n,key:r,props:o,proxy:lt(e,t)}}function ft(e){if(!e)return;if(Array.isArray(e))return void e.forEach(e=>ft(e));const{proxy:t}=e;t&&t.destroy()}function pt(e,t,n){if(!n)return ht(e,t);if(!t)return ft(n),null;if(Array.isArray(n)){if(!n.length)return ht(e,t);const r=n.findIndex(e=>e.tag===t.tag);if(r<0)return ft(n),ht(e,t);const o=n;[n]=n.splice(r,1),ft(o)}if(t.tag!==n.tag)return ft(n),ht(e,t);if(n.proxy){const{proxy:e}=n,{props:r={},key:o}=t;return e.update(t.props||{},t.children||[]),{tag:n.tag,props:r,key:o,proxy:e}}return ft(n),ht(e,t)}function yt(e,t,n){n||(n=[]),Array.isArray(n)||(n=[n]);const r=[];for(const o of function*e(t){if(Array.isArray(t))for(const n of t)yield*e(n);else yield t}(t)){const t=Z(o);if(!t)continue;const i=n.findIndex(e=>e.tag===t.tag&&e.key===t.key);if(i>=0){const o=pt(e,t,n[i]);o&&r.push(o),n.splice(i,1)}else{const n=ht(e,t);n&&r.push(n)}}return ft(n),r}function*mt(e,t,n){Array.isArray(t)||(t=[t]);let r=0,o=Math.min(t.length||1,n.length);for(;r<o;r++){const o=t[r];Array.isArray(o)?yield yt(e,o,n[r]):yield pt(e,Z(o),n[r])}if(o=Math.max(t.length,t.length),n.length>r)for(;r<o;r++)ft(n[r]);if(t.length>r)for(;r<o;r++){const n=Z(t[r]);Array.isArray(n)?yield n.flat(1/0).map(t=>ht(e,t)).filter(Boolean):yield ht(e,n)}}function _t(e,n,r){return $e(r?()=>t.postpone(()=>[...mt(e,n,r)]):()=>t.postpone(()=>function(e,t){return Array.isArray(t)||(t=[t]),t.length?t.map(t=>Array.isArray(t)?t.flat(1/0).map(t=>ht(e,Z(t))).filter(Boolean):ht(e,Z(t))):[]}(e,n)))}let vt=new Set;const bt=new Set,gt=[],$t=[],wt=[];function xt(e){const n=[...e].sort(([e],[t])=>t-e);e.length=0;try{n.forEach(([,e])=>e())}catch(e){t.printError(e)}}let jt=!1;function Ct(){var e;jt||(jt=!0,e=()=>{jt=!1,xt(gt),function(){const e=[...vt];vt.clear(),e.map(e=>e.drawAll())}(),xt($t),function(){const e=[...bt];bt.clear();for(const n of e)try{n()}catch(e){t.printError(e)}}(),xt(wt)},o(i,"The basic renderer is not installed","install"),i(e))}function St(e,t=0,n){("middle"===n?$t:"end"===n?wt:gt).push([t,e]),Ct()}function Rt(e){bt.add(e),Ct()}class Dt extends Qe{setmountedRoot(e,t){if(this.parentProxy)return;const n=this.__container;if(!n)return;const{renderer:r}=this,[o,i]=r.getContainer(n,e,t);if(o)for(const e of ie(this.tree))r.insertNode(o,e,i)}constructor(e,t=null,r={},o,i){super(t?c(t[$],null==i?void 0:i.renderer):c(null==i?void 0:i.renderer),e,t,r,i),n(this,"container",void 0),n(this,"componentRoot",void 0),n(this,"__containerData",void 0),n(this,"content",[]),n(this,"rootContainer",this),n(this,"contextData",void 0),n(this,"__nodes",[]),n(this,"__container",null),n(this,"__placeholder",void 0),n(this,"__placeholderNode",void 0),n(this,"__targetNode",null),n(this,"__insertNode",null),n(this,"__nextNode",null),n(this,"__awaitDraw",new Set),n(this,"__containers",new Set),this.container=this,this.componentRoot=null==i?void 0:i.componentRoot,this.contextData={hooks:{}},t&&(this.__containerData=t[C]),this.events.updateInProps(r),i&&(this.rootContainer=i.container.rootContainer),this.__nodes=_t(this,o),this.created=!0}createEntity(e){return function(e,t){const n={data:{configurable:!0,value:e.data},exposed:{configurable:!0,get:()=>e.exposed},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},callHook:{configurable:!0,value(t){v(t,e.contextData)}},setHook:{configurable:!0,value:(t,n)=>_(t,n,e.contextData)},on:{configurable:!0,value:t.on},emit:{configurable:!0,value:t.emit}};return Object.create(null,n)}(this,e)}setChildren(e){this.destroyed||(this.__nodes=_t(this,e,this.__nodes),this.requestDraw())}_update(e,t){this.destroyed||(this.__nodes=_t(this,t,this.__nodes),this.events.updateInProps(e),this.requestDraw())}_destroy(){ft(this.__nodes)}callHook(e){v(e,this.contextData)}requestDraw(){this.markDraw(this)}_mount(e){const{parentProxy:t,renderer:n}=this,r=(null==t?void 0:t.renderer)||n,{container:o,target:i,insert:s,next:c,exposed:a}=n.mountContainer(this.__containerData,this.attrs,this.events.emit,null==t?void 0:t.renderer);this.setExposed(a);const u=n.getMountOptions(o,e)||e,d=ee(r);this.__placeholder=d;const l=d.node;this.__placeholderNode=l,this.__container=o;const h=le(n,u,this.__nodes);if(this.content=h,this.__insertNode=s,this.__nextNode=c,!i&&r===n)return this.tree=s?[...h,X({node:s}),d]:[...h,d],u;const f=i||o;this.__targetNode=f;for(const e of ie(h))n.insertNode(f,e,c);return this.tree=s?[X({node:s}),d]:[d],u}_redrawSelf(){const{__targetNode:e,__insertNode:t,__nextNode:n}=this,{attrs:r,parentProxy:o,renderer:i}=this,s=this.__placeholder,c=this.__placeholderNode,a=this.__container,u=(null==o?void 0:o.renderer)||i,{target:d,insert:l,next:h}=i.updateContainer(a,e,t,n,this.__containerData,r,this.events.emit,null==o?void 0:o.renderer);this.__insertNode=l,this.__nextNode=h;const f=u.getParent(c);if(l!==t&&(t&&i.removeNode(t),l&&f&&i.insertNode(f,l,c)),d||u!==i){const t=d||a;if(this.__targetNode=t,t!==e||h!==n)for(const e of ie(this.content))i.insertNode(t,e,h);this.tree=l?[X({node:l}),s]:[s]}else{const{content:t}=this;if(e&&f){const e=l||c;for(const n of ie(t))u.insertNode(f,n,e);this.__targetNode=null}this.tree=l?[...t,X({node:l}),s]:[...t,s]}i.recoveryContainer(a,e,t,n,d,l,h,this.__containerData,r,null==o?void 0:o.renderer)}_redrawChildren(e){const t=le(this.renderer,e,this.__nodes,this.content);if(this.content=t,!this.__targetNode)return;const n=this.__placeholder,r=this.__insertNode;this.tree=r?[...t,X({node:r}),n]:[...t,n]}_redraw(e){this._redrawChildren(e),this._redrawSelf()}_unmount(){const{parentProxy:e,renderer:t,__insertNode:n}=this,r=(null==e?void 0:e.renderer)||t;oe(this.renderer,this.content),n&&r.removeNode(n),r.removeNode(this.__placeholderNode),t.unmountContainer(this.__container,this.__targetNode,n,this.__nextNode,this.__containerData,this.attrs,null==e?void 0:e.renderer)}markDraw(e){var t;(null===(t=this.parentProxy)||void 0===t?void 0:t.renderer)!==this.renderer?(e===this&&this.parentProxy?this.parentProxy.container.markDraw(this):this.__awaitDraw.add(e),this.rootContainer.markDrawContainer(this)):this.parentProxy.container.markDraw(e)}drawContainer(){if(this.destroyed||!this.__container)return;const{__awaitDraw:e}=this,t=[...e];e.clear(),t.map(e=>e.redraw())}markDrawContainer(e){var t;this.__containers.add(e),t=this,vt.add(t),Ct()}drawAll(){const e=this.__containers;if(!e.size)return;const t=[...e];e.clear();const n=[];fe(n),t.forEach(e=>e.drawContainer()),n.forEach(e=>e())}}function kt(e,n,r=[]){const o=t.value(r),i={renderer:e?c(e[$]):c(),refresh:d,slotRenderFnList:new WeakMap,delivered:Object.create(null),simpleParent:void 0};let s,a=!1,u=!1;function d(){if(!s)return void(a=!0);if(s.destroyed)return;if(a=!0,!s.created)return;if(u)return;let e;for(u=!0;!be(l)&&a;)if(a=!1,e=f(),s.destroyed)return;u=!1,be(l)||e&&s.mounted&&(s.destroyed||s.unmounted||s.setChildren(e))}const l={refresh:d},h=Object.create(null),f=t.monitor(e=>e&&d(),()=>ze(i,o.value,h,[],!1,!1));return s=new Dt(e,e,n,f()),a&&d(),[s,o]}function Nt(e,t={}){const[n,r]=function(e,t){if(void 0===e)return kt(null,t);if(A(e))return kt(e,t);if(!U(e))return kt(null,t,[F(e)]);if(A(e.tag)){const n={...e.props,...t};return kt(e.tag,n)}return kt(null,t,[e])}(e,t),o=Object.create(n.entity,{update:{configurable:!0,value:e=>(n.destroyed||r(void 0===e?[]:U(e)?[e]:[F(e)]),o)},mount:{configurable:!0,value:(e,t)=>(n.destroyed||n.mounted||(n.mount({}),n.setmountedRoot(e,t)),o)},unmount:{configurable:!0,value(){if(n.mounted&&!n.unmounted)return n.destroyed||n.destroy(),n.unmount(),o}}});return o}function Tt(e,t){return Reflect.defineProperty(e,S,{value:t}),e}function Ot(e,t){return t&&"string"==typeof t?(Reflect.defineProperty(e,w,{value:t}),e):e}function At(e,t){return Reflect.defineProperty(e,C,{value:t}),e}function Et(e,t){return t&&"object"==typeof t?(Reflect.defineProperty(e,x,{value:t}),e):e}function Pt(){return function e(t){return F(e,t)}}function Mt(e){const t=Pt();return Tt(t,"$$$objectType$$$DeliverComponent"),Reflect.defineProperty(t,R,{value:Symbol()}),Reflect.defineProperty(t,D,{value:e}),t}function Vt(e,{name:t,components:n}={}){const r=Pt();return Tt(r,"$$$objectType$$$RenderComponent"),Ot(r,t),At(r,e),Et(r,n),r}function Ht(e,{name:t,renderer:n}={}){const r=Pt();return Tt(r,"$$$objectType$$$ContainerComponent"),Ot(r,t),At(r,e),"string"!=typeof n&&"object"!=typeof n||Reflect.defineProperty(r,$,{value:n}),r}function qt(e,{name:t}={}){const n=Pt();return Tt(n,"$$$objectType$$$ElementComponent"),Ot(n,t),At(n,e),n}function It(e,{name:t,components:n,render:r,props:o}={}){const i=Ft(e,r);return Ot(i,t),Et(i,n),Array.isArray(o)&&Reflect.defineProperty(i,j,{value:[...o]}),i}function Ft(e,t){if("function"!=typeof t)return e;const n=O(t)?t:Vt(t);return function(t,r){return F(n,e(t,r))}}function Lt(e,{name:t,components:n,render:r,props:o}={}){const i=Ft(e,r);return Tt(i,"$$$objectType$$$NativeComponentNode"),Ot(i,t),Et(i,n),Array.isArray(o)&&Reflect.defineProperty(i,j,{value:[...o]}),i}function zt(e,{name:t,components:n}={}){const r=e;return Tt(r,"$$$objectType$$$SimpleComponent"),Ot(r,t),Et(r,n),r}function Wt(e,{name:t}={}){const n=e;return Tt(n,"$$$objectType$$$ShellComponent"),Ot(n,t),n}function Bt(e,t){switch(t){case"standardComponent":return e instanceof at;case"renderComponent":return e instanceof st;case"component":return e instanceof ot;case"container":return e instanceof Dt;case"deliver":return e instanceof Ue;case"element":return e instanceof Xe;case"group":return e instanceof Ge;case"shell":return e instanceof et;case"value":return e instanceof Ke;case"slot":return e instanceof tt;case"node":return e instanceof me;case"ref":return e instanceof Qe}return e instanceof ye}function Kt(e,t,...n){const r=t?{...t}:{},o={};for(const e of Object.keys(r))if("@"!==e)if("!"!==e[0])if("@"!==e[0])if("n-"!==e.substr(0,2))if("on-"!==e.substr(0,3))if("hook-"!==e.substr(0,5))"data-"===e.substr(0,5)&&(o["data:"+e.substr(5)]=r[e]),o[e]=r[e];else{const t=r[e];"function"!=typeof t&&null!=t||(o["hook:"+e.substr(5)]=t)}else{const t=r[e];"function"!=typeof t&&null!=t||(o["on:"+e.substr(3)]=t)}else o["n:"+e.substr(2)]=r[e];else o["on:"+e.substr(1)]=r[e];else o["n:"+e.substr(1)]=r[e];else o["n:on"]=r[e];return F(e,o,...n)}const Ut=p({name:"useValue",create:e=>"function"==typeof e?e():t.value(void 0)});function Gt(e,n){return!e||"function"!=typeof e&&"object"!=typeof e?n?function(e){const n=e?t.value(void 0):{value:void 0};function r(e,t,r,o){n.value=!1===o?r:void 0}return Reflect.defineProperty(r,"value",{get:()=>n.value,enumerable:!0,configurable:!0}),r}(e):function(e){const n=e?t.value(void 0):{value:void 0};function r(e){n.value=e}return Reflect.defineProperty(r,"value",{get:()=>n.value,enumerable:!0,configurable:!0}),r}(e):n?function(e){return function(t,n,r,o){!0!==o?!1===o&&e.delete(r):e.add(r)}}(e):function(e){return function(t,n){void 0!==t?void 0!==n?"function"!=typeof e.replace?(e.delete(n),e.add(t)):e.replace(t,n):e.add(t):void 0!==n&&e.delete(n)}}(e)}function Jt(e,n){const r=t.value(0);let o=!1;const i=t.value(void 0);return zt((t,{childNodes:s})=>{const c=i();return c?Kt(c,t,...s()):(async function(){if(!o&&(o=!0,!r())){r(1);try{const t=await e();if("function"==typeof t)return void i(t);if(!t)return void r(-1);if("function"==typeof t.default)return void i(t.default);r(-1)}catch(e){console.error(e),r(-1)}}}(),n?Kt(n,{loading:0===r()}):null)},{name:"Lazy"})}function Qt(e,{slot:t,key:n}={}){return{[S]:"$$$objectType$$$Element",tag:z,props:{"n:key":n,"n:slot":t},children:[e],key:n,slot:t}}function Xt(e,t={}){if(Array.isArray(e)){const n=[];for(let r of e)n.push(Xt(r,t));return[].concat(...n)}if(!U(e))return[e];let{tag:n}=e;if(!n)return[e];if("template"===n)return Xt(e.children,t);if(!k(n))return[e];const{simple:r}=t;if(Array.isArray(r)){if(r.includes(n))return[e]}else if("function"==typeof r){if(r(n))return[e]}else if(r)return[e];return Xt(e.children,t)}function Yt(e){if(!U(e))return!1;const{tag:t}=e;return"string"==typeof t&&"template"===t.toLowerCase()}function Zt(e){return U(e)&&k(e.tag)}const en=je({name:"withAncestor",create:()=>H(),exec(e,t,n,r=0){for(let t=r+1;e&&t>0;t--){if(e.component===n)return e;e=e.parent}}});var tn=Object.freeze({__proto__:null,install:a,Error:r,render:Nt,register:He,getNode:Y,createDeliverComponent:Mt,createRenderComponent:Vt,createContainerComponent:Ht,createElementComponent:qt,createStandardComponent:It,createNativeComponent:Lt,createSimpleComponent:zt,createShellComponent:Wt,createComponent:It,isSimpleComponent:k,isShellComponent:N,isNativeComponent:T,isRenderComponent:O,isContainerComponent:A,isElementComponent:E,isDeliverComponent:P,isDeliver:P,version:"0.1.0-alpha.19",isProduction:!0,ScopeSlot:L,Render:z,Slot:W,Container:B,Template:"template",Fragment:"template",rendererSymbol:$,nameSymbol:w,componentsSymbol:x,propsSymbol:j,componentValueSymbol:C,objectTypeSymbol:S,objectTypeSymbolElement:"$$$objectType$$$Element",objectTypeSymbolDeliverComponent:"$$$objectType$$$DeliverComponent",objectTypeSymbolNativeComponent:"$$$objectType$$$NativeComponentNode",objectTypeSymbolSimpleComponent:"$$$objectType$$$SimpleComponent",objectTypeSymbolShellComponent:"$$$objectType$$$ShellComponent",objectTypeSymbolRenderComponent:"$$$objectType$$$RenderComponent",objectTypeSymbolContainerComponent:"$$$objectType$$$ContainerComponent",objectTypeSymbolElementComponent:"$$$objectType$$$ElementComponent",objectTypeSymbolRootEntity:"$$$objectType$$$RootEntity",deliverKeySymbol:R,deliverDefaultSymbol:D,value:t.value,computed:t.computed,isValue:t.isValue,encase:t.encase,valueify:t.valueify,asValue:t.asValue,mixValue:t.mixValue,defineProperty:t.defineProperty,withWatch:b,withHook:g,withDelivered:M,withRefresh:V,withParent:H,withChildren:q,withCallback:I,createElementBase:F,createTemplateElement:K,equal:G,isElement:U,isRenderElement:J,withLabel:Q,delayRefresh:$e,nextTick:St,addRendererDraw:Rt,addRecognizer:dt,isProxy:Bt,createUse:p,createWith:je,createElement:Kt,useValue:Ut,ref:Gt,lazy:Jt,createRenderElement:Qt,elements:Xt,isFragmentElement:Yt,isSimpleElement:Zt,withAncestor:en});Object.defineProperty(e,"asValue",{enumerable:!0,get:function(){return t.asValue}}),Object.defineProperty(e,"computed",{enumerable:!0,get:function(){return t.computed}}),Object.defineProperty(e,"defineProperty",{enumerable:!0,get:function(){return t.defineProperty}}),Object.defineProperty(e,"encase",{enumerable:!0,get:function(){return t.encase}}),Object.defineProperty(e,"isValue",{enumerable:!0,get:function(){return t.isValue}}),Object.defineProperty(e,"mixValue",{enumerable:!0,get:function(){return t.mixValue}}),Object.defineProperty(e,"value",{enumerable:!0,get:function(){return t.value}}),Object.defineProperty(e,"valueify",{enumerable:!0,get:function(){return t.valueify}}),e.Container=B,e.Error=r,e.Fragment="template",e.Render=z,e.ScopeSlot=L,e.Slot=W,e.Template="template",e.addRecognizer=dt,e.addRendererDraw=Rt,e.componentValueSymbol=C,e.componentsSymbol=x,e.createComponent=It,e.createContainerComponent=Ht,e.createDeliverComponent=Mt,e.createElement=Kt,e.createElementBase=F,e.createElementComponent=qt,e.createNativeComponent=Lt,e.createRenderComponent=Vt,e.createRenderElement=Qt,e.createShellComponent=Wt,e.createSimpleComponent=zt,e.createStandardComponent=It,e.createTemplateElement=K,e.createUse=p,e.createWith=je,e.default=tn,e.delayRefresh=$e,e.deliverDefaultSymbol=D,e.deliverKeySymbol=R,e.elements=Xt,e.equal=G,e.getNode=Y,e.install=a,e.isContainerComponent=A,e.isDeliver=P,e.isDeliverComponent=P,e.isElement=U,e.isElementComponent=E,e.isFragmentElement=Yt,e.isNativeComponent=T,e.isProduction=!0,e.isProxy=Bt,e.isRenderComponent=O,e.isRenderElement=J,e.isShellComponent=N,e.isSimpleComponent=k,e.isSimpleElement=Zt,e.lazy=Jt,e.nameSymbol=w,e.nextTick=St,e.objectTypeSymbol=S,e.objectTypeSymbolContainerComponent="$$$objectType$$$ContainerComponent",e.objectTypeSymbolDeliverComponent="$$$objectType$$$DeliverComponent",e.objectTypeSymbolElement="$$$objectType$$$Element",e.objectTypeSymbolElementComponent="$$$objectType$$$ElementComponent",e.objectTypeSymbolNativeComponent="$$$objectType$$$NativeComponentNode",e.objectTypeSymbolRenderComponent="$$$objectType$$$RenderComponent",e.objectTypeSymbolRootEntity="$$$objectType$$$RootEntity",e.objectTypeSymbolShellComponent="$$$objectType$$$ShellComponent",e.objectTypeSymbolSimpleComponent="$$$objectType$$$SimpleComponent",e.propsSymbol=j,e.ref=Gt,e.register=He,e.render=Nt,e.rendererSymbol=$,e.useValue=Ut,e.version="0.1.0-alpha.19",e.withAncestor=en,e.withCallback=I,e.withChildren=q,e.withDelivered=M,e.withHook=g,e.withLabel=Q,e.withParent=H,e.withRefresh=V,e.withWatch=b,Object.defineProperty(e,"__esModule",{value:!0})}));
