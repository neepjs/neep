/*!
 * Neep v0.1.0-alpha.10
 * (c) 2019-2020 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("monitorable")):"function"==typeof define&&define.amd?define(["exports","monitorable"],t):t((e=e||self).Neep={},e.Monitorable)}(this,(function(e,t){"use strict";var n=Object.freeze({version:"0.1.0-alpha.10",isProduction:!0});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o extends Error{constructor(e,t=""){super(t?`[${t}] ${e}`:e),r(this,"tag",void 0),this.tag=t}}let i;function s(e){!function(e,t,n){if(!e)throw new o(t,n)}(i,"The basic renderer is not installed","install"),i(e)}const c=Object.create(null);function a(e=""){return"object"==typeof e?e:c[e]||c.default}function l(e){return"@"===e[0]?e.substr(1):/^on[:-]/.test(e)?e.substr(3):/^n([:-])on(\1|:)/.test(e)?e.substr(5):""}function d(e,t){if(t)if("function"!=typeof t){if("object"==typeof t)for(const n of Object.keys(t)){const r=t[n];"function"==typeof r&&e(n,r)}}else{const{names:n}=t;if(!Array.isArray(n))return;for(const r of n)r&&e(r,(...e)=>t(r,...e))}}class u{static update(e,t){if(!t)return[];const n=[];if(t&&"object"==typeof t)for(const r of Object.keys(t)){if(!r)continue;const o=t[r];"function"==typeof o&&n.push(e.on(r,o))}return n}static updateInProps(e,t,n){if(!t)return[];const r=[];function o(t,n){r.push(e.on(t,n))}for(const e of Object.keys(t)){const n=t[e];if("function"!=typeof n)continue;const r=l(e);r&&o(r,n)}return d(o,t["@"]),d(o,t["n:on"]),d(o,t["n-on"]),"function"==typeof n&&n(o),r.push(...u.update(e,t["@"])),r}get names(){return[...this._names]}constructor(){r(this,"_names",new Set),r(this,"_cancelHandles",new Set),r(this,"emit",void 0),r(this,"on",void 0);const e=Object.create(null),n=this._names;function o(...r){function i(t,...n){const r=e[t];if(!r)return!0;let o=!0;for(const e of[...r])o=e(...n)&&o;return o}return i.omit=(...e)=>o(...r,...e),Reflect.defineProperty(i,"names",{get:()=>(t.markRead(o,"names"),[...n].filter(e=>!r.includes(e))),configurable:!0}),i}this.emit=o(),this.on=(r,i)=>{var s;function c(...e){try{return!1!==i(...e)}catch(e){return console.error(e),!1}}let a=e[r];(null===(s=a)||void 0===s?void 0:s.size)||(a=new Set,e[r]=a,t.markChange(o,"names"),n.add(r)),a.add(c);let l=!1;return()=>{l||(l=!0,a.delete(c),a.size||(t.markChange(o,"names"),n.delete(r)))}}}updateHandles(e){const t=this._cancelHandles,n=[...t];t.clear();for(const e of n)e();return e.forEach(e=>t.add(e)),e}update(e){const t=u.update(this,e);return this.updateHandles(t)}updateInProps(e,t){const n=u.updateInProps(this,e,t);return this.updateHandles(n)}}const f="Neep:ScopeSlot",h="Neep:SlotRender",p="Neep:Slot",y="Neep:Value",v="template",m=v;var g=Object.freeze({ScopeSlot:f,SlotRender:h,Slot:p,Value:y,Container:"Neep:Container",Deliver:"Neep:Deliver",Template:v,Fragment:m});function _(t,n){const r=e.current;e.current=n;try{e.current.$_valueIndex=0;const n=t();if(e.current.$_valueIndex!==e.current.$_values.length)throw new o("Inconsistent number of useValue executions","life");return n}finally{e.current=r}}function b(t,n=!1){if(!e.current)throw new o(`Function \`${t}\` can only be called within a cycle.`,"life");if(!n)return e.current;if(!e.current.created)return e.current;throw new o(`Function \`${t}\` can only be called at initialization time.`,"life")}const w=[];function R(e,t){for(const n of w)n(e,t);return e}let x=0;const k=new Set;function A(e){return!(x<=0)&&(k.add(e),!0)}function j(){if(x>0)return;const e=[...k];k.clear(),e.forEach(e=>e.refresh())}function S(e,t){if(t)return async function(e){try{return x++,await e()}finally{x--,j()}}(e);try{return x++,e()}finally{x--,j()}}const C=Object.create(null);function D(e,n,r){let o=(null==r?void 0:r.$_hooks)||C;if(!o)return()=>{};n=t.safeify(n);let i=o[e];return i||(i=new Set,o[e]=i),i.add(n),()=>i.delete(n)}function O(e,t){if(t){for(const n of t.$_hooks[e]||[])n(t);for(const n of C[e]||[])n(t)}}function N(e,n){const r=b("watch");if("function"!=typeof e)return()=>{};const o=t.isValue(e)?e.watch(n):t.computed(e).watch((e,t)=>n(e(),t));return D("beforeDestroy",()=>o(),r),o}function P(e,n="useValue"){const r=b(n),i=r.$_valueIndex++,s=r.$_values;if(!r.created){s[i]=void 0;const n="function"==typeof e?e():t.value(void 0);return s[i]=n}if(i>=s.length)throw new o("Inconsistent number of useValue executions","life");return s[i]}function H(e,t,n){const r=b("setHook");if(!n||!r.created)return D(e,()=>t(),r)}function $(e,n,r,o){"string"==typeof n&&["$","_"].includes(n[0])||(t.isValue(r)&&o?Reflect.defineProperty(e,n,{get:()=>r(),set(e){r(e)},configurable:!0,enumerable:!0}):"function"==typeof r&&o?Reflect.defineProperty(e,n,{get:r,set:"function"==typeof o?o:void 0,configurable:!0,enumerable:!0}):Reflect.defineProperty(e,n,{get:()=>r,configurable:!0,enumerable:!0}))}function V(e,t,n){$(b("expose",!0).exposed,e,t,n)}function E(e,t,n){$(b("deliver",!0).delivered,e,t,n)}var I=Object.freeze({watch:N,useValue:P,hook:H,expose:V,deliver:E});const T=Symbol.for("isNeepElement"),z=Symbol.for("type"),M=Symbol.for("name"),q=Symbol.for("render"),F=Symbol.for("components"),K=Symbol.for("config");function L(e){return!!e&&("object"==typeof e&&!0===e[T])}function B(e,t,...n){t=t?{...t}:{};const r={[T]:!0,tag:e,key:void 0,children:[]};if("n:key"in t?r.key=t.key:"n-key"in t&&(r.key=t.key),"slot"in t&&(r.slot=t.slot),"function"==typeof t.ref&&(r.ref=t.ref),e===y)return r.value=t.value,r;if(r.children=n,e===v)return r;if(e===h)return r.render=t.render,r;if(e===f||e===p){const{render:n,argv:o,args:i,name:s}=t;if(r.render=n,r.args=o&&[o]||Array.isArray(i)&&i.length&&i||[{}],e===f)return r.props={name:s},r}r.props={};for(let e in t)r.props[e]=t[e];return r}function U(e,t={}){if(Array.isArray(e)){const n=[];for(let r of e)n.push(U(r,t));return[].concat(...n)}if(!L(e))return[e];let{tag:n}=e;if(!n)return[e];if([v,f].includes(n))return U(e.children,t);if("function"!=typeof n)return[e];if("simple"!==n[z])return[e];const{simple:r=!0}=t;if(!r)return[e];if(Array.isArray(r)){if(r.includes(n))return[e]}else if("function"==typeof r&&!r(n))return[e];return U(e.children,t)}var G=Object.freeze({isElement:L,createElement:B,elements:U});function J(e,t=""){}var Q=Object.freeze({label:J});const W={...g,...I,...G,...Q,...n,get value(){return t.value},get computed(){return t.computed},get isValue(){return t.isValue},get encase(){return t.encase},get recover(){return t.recover},get valueify(){return t.valueify},get asValue(){return t.asValue}};function X(e,t){return{...e,id:0}}function*Y(e){if(Array.isArray(e))for(const t of e)yield*Y(t);else yield e}let Z;function ee(e){Z=e}function te(e,t,n){"function"==typeof e&&t&&(Z?Z.push(()=>e(t,n)):e(t,n))}function ne(e){if(Array.isArray(e))return ne(e[e.length-1]);const{component:t,children:n,node:r}=e;return r||ne(t?t.tree:n)}function re(e){if(Array.isArray(e))return re(e[0]);const{component:t,children:n,node:r}=e;return r||re(t?t.tree:n[0])}function*oe(e){if(Array.isArray(e)){for(const t of e)yield*oe(t);return}const{children:t,node:n,component:r}=e;n?yield n:r?yield*oe(r.tree):yield*oe(t)}function ie(e,t){if(Array.isArray(t))return void t.forEach(t=>ie(e,t));const{component:n,children:r,node:o,ref:i}=t;return o?(te(i,o,!0),void e.remove(o)):n?(te(i,n.exposed,!0),void n.unmount()):void ie(e,r)}function se(e,t,n){const r=re(n);if(!r)return t;const o=e.parent(r);if(!o)return t;for(const n of oe(t))e.insert(o,n,r);return ie(e,n),t}function ce(e,t,n){if(!t.length){return[se(e,he(e,{tag:null,children:[]}),n)]}Array.isArray(n)||(n=[n]);const r=[],o=[...n],i=new Map;for(const n of t){const t=o.findIndex(e=>e.tag===n.tag&&e.key===n.key);if(t>=0){const s=o[t],c=le(e,n,s);i.set(s,c),r.push(c),o.splice(t,1)}else{const t=he(e,n);r.push(t)}}if(!i.size)return se(e,r,o);ie(e,o);const s=ne((n=n.filter(e=>i.has(e)))[n.length-1]),c=e.parent(s);if(!c)return r;let a=e.next(s);for(let t=r.length-1;t>=0;t--){const o=r[t],s=n.findIndex(e=>i.get(e)===o);if(s>=0)for(const e of n.splice(s))i.delete(e);else for(const t of oe(o))e.insert(c,t,a);a=re(o)||a}return r}function ae(e,t,n){let r=0,o=Math.min(t.length,t.length||1);const i=[];for(;r<o;r++){const o=t[r];Array.isArray(o)?i.push(ce(e,o,n[r])):i.push(le(e,o,n[r]))}if(o=Math.max(t.length,n.length),n.length>o)for(;r<o;r++)ie(e,n[r]);if(t.length>o){const n=ne(i[i.length-1]),s=e.parent(n),c=e.next(n);for(;r<o;r++){const n=t[r],o=Array.isArray(n)?fe(e,n):he(e,n);if(i.push(o),s)for(const t of oe(o))e.insert(s,t,c)}}return i}function le(e,n,r){if(Array.isArray(r)){const t=r.findIndex(e=>e.tag===n.tag&&e.component===n.component);if(t<0)return se(e,he(e,n),r);const o=r;[r]=r.splice(t,1),ie(e,o)}const{tag:o,component:i}=n,s=n.ref!==r.ref&&n.ref||void 0;if(o!==r.tag||i!==r.component)return se(e,he(e,n),r);if(!o)return r;const c="string"!=typeof o?"":o.toLowerCase();if("string"!=typeof o||"neep:container"===c)return i?(te(s,i.exposed),X({...n,node:void 0,component:i,children:[]},r.id)):X({...n,node:void 0,component:void 0,children:pe(e,n.children,r.children)},r.id);if("neep:value"===c){let o=n.value;return t.isValue(o)&&(o=o()),r.value===o?(te(s,r.node),X({...r,...n,value:o,children:[]},r.id)):se(e,de(e,n,o),r)}if("neep:"===c.substr(0,5)||"template"===c)return X({...n,node:void 0,component:void 0,children:ae(e,n.children,r.children)},r.id);const{node:a}=r;if(e.update(a,n.props||{}),te(s,a),!n.children.length&&!r.children.length)return X({...r,...n,children:[]},r.id);if(!n.children.length&&r.children.length&&ie(e,r.children),n.children.length&&!r.children.length){const t=ue(e,n.children);for(const n of oe(t))e.insert(a,n);return X({...r,...n,children:t},r.id)}return X({...r,...n,children:ae(e,n.children,r.children)},r.id)}function de(e,t,n){let{ref:r}=t;if(e.isNode(n))return te(r,n),X({...t,value:n,node:n,children:[],component:void 0});const o=typeof n;let i;return"bigint"===o||"boolean"===o||"number"===o||"string"===o||"symbol"===o||n instanceof RegExp?i=e.text(String(n)):n instanceof Date?i=e.text(n.toISOString()):"object"===o&&n&&(i=e.text(String(n))),i||(i=e.placeholder()),te(r,i),X({...t,value:n,node:i,component:void 0,children:[]})}function ue(e,t){return t.length?t.map(t=>Array.isArray(t)?fe(e,t):he(e,t)):[X({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function fe(e,t){return t.length?t.map(t=>he(e,t)):[X({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function he(e,n){var r;const{tag:o,ref:i,component:s}=n;if(!o){const t=e.placeholder();return te(i,t),X({tag:null,node:t,component:void 0,children:[]})}const c="string"!=typeof o?"":o.toLowerCase();if("string"!=typeof o||"neep:container"===c)return s?(s.mount(),te(i,s.exposed),X({...n,node:void 0,component:s,children:[]})):X({...n,node:void 0,component:void 0,children:pe(e,n.children)});if("neep:value"===c){let r=n.value;return t.isValue(r)&&(r=r()),de(e,n,r)}if("neep:"===c.substr(0,5)||"template"===c)return X({...n,node:void 0,component:void 0,children:ue(e,n.children)});const a=e.create(o,n.props||{});te(i,a);let l=[];if(null===(r=n.children)||void 0===r?void 0:r.length){l=ue(e,n.children);for(const t of oe(l))e.insert(a,t)}return X({...n,node:a,component:void 0,children:l})}function pe(e,t,n){return n?ae(e,t,n):ue(e,t)}function ye(e,t,n,r=!1){const o=[];for(const i of t){if(Array.isArray(i)){const t=Object.create(null);o.push(ye(e,i,t,r));for(const e of Reflect.ownKeys(t))e in n?n[e].push(t[e]):n[e]=[t[e]];continue}if(r){if(e.isNode(i)){o.push(i);continue}if(!L(i)){o.push(i);continue}if(i.tag!==h){o.push(i);continue}}const t=L(i)&&i.slot||"default",s=L(i)?{...i,slot:void 0,props:{...i.props,slot:void 0}}:i;t in n?n[t].push(s):n[t]=[s]}return o}function ve(e,...t){return e.map(e=>Array.isArray(e)?ve(e,...t):L(e)?e.tag!==h?{...e,slot:void 0}:"function"==typeof e.render?e.render(...t):e.children:e)}function me(e,t){const n=(...e)=>({[T]:!0,tag:f,children:ve(t,...e),inserted:!0,label:void 0});return n.children=t,n}function ge(e,t=Object.create(null)){for(const n of Reflect.ownKeys(t))n in e||delete t[n];for(const n of Reflect.ownKeys(e))t[n]=me(0,e[n]);return t}const _e=new Set([":","@","#","*","!","%","^","~","&","=","+",".","(",")","[","]","{","}","<",">"]);function be(e){return"string"!=typeof e||!_e.has(e[0])&&(!/^n[:-]/.test(e)&&!/^on[:-]/.test(e))}function we(e,n,r={},o=!1,i=!1){const s=Reflect.ownKeys(n),c=new Set(i?s.filter(be):s);for(const t of Reflect.ownKeys(e))c.has(t)||delete e[t];if(!o){for(const t of c)e[t]=n[t];return e}for(const o of c){const i=n[o];o in r&&r[o]===i||(t.isValue(i)?Reflect.defineProperty(e,o,{configurable:!0,enumerable:!0,get:()=>i(),set(e){i(e)}}):Reflect.defineProperty(e,o,{configurable:!0,enumerable:!0,value:i}))}return e}const Re=Object.create(null);function xe(...e){return e.filter(Boolean)}function ke(e,t){if(!e)return null;if("string"!=typeof e)return e;if("template"===e)return e;if(/^neep:.+/i.test(e))return e;for(const n of t){const t=n[e];if(t)return t}return Re[e]||e}function Ae(e,t,n,r,o,i){const{inserted:s,args:c=[{}]}=n;let a=ke(n.tag,o);if("Neep:Deliver"===a){const s={...n.props};return delete s.ref,delete s.slot,delete s.key,{...n,tag:a,children:n.children.map(n=>je(e,we(Object.create(t),s||{},{},!0),n,r,o,i))}}const l=n.children.map(n=>je(e,t,n,r,o,i));return"function"==typeof a?"simple"===a[z]?function(e,t,n,r,o,i){if(n.execed)return n;const{iRender:s}=e,c=Object.create(null);ye(s,i,c);const a=ge(c),l=new u;l.updateInProps(n.props);const d={...n.props},f=R({slots:a,created:!1,parent:e.exposed,delivered:t,children:new Set,childNodes:i,refresh(t){e.refresh(t)},emit:l.emit}),h=r(d,f,W),p=je(e,t,Se(s,h,f,r[q]),a,xe(...o,r[F]),!1);return{...n,tag:r,execed:!0,children:Array.isArray(p)?p:[p],label:void 0}}(e,t,n,a,o,je(e,t,l,r,o,i)):{...n,children:l,tag:a}:(a===p&&(a=i?"slot":f),a!==f||s?{...n,children:l,tag:a}:function(e,t,n,r,o,i,s=[{}],c){var a;const l=r[(null===(a=n.props)||void 0===a?void 0:a.name)||"default"];if("function"==typeof l)return{...n,...l(...s)};const{render:d}=n;return{...n,tag:f,label:void 0,children:je(e,t,"function"!=typeof d?i:d(...s),r,o,c)}}(e,t,{...n,tag:a},r,o,l,c,i))}function je(e,t,n,r,o,i){return Array.isArray(n)?n.map(n=>je(e,t,n,r,o,i)):L(n)?Ae(e,t,n,r,o,i):n}function Se(e,t,n,r){return Array.isArray(t)?t:L(t)?[t]:null==t?[{[T]:!0,tag:null,key:void 0,children:[]}]:(!e.isNode(t)&&t&&"object"==typeof t&&r&&(t=r(t,n,W)),L(t)?[t]:null==t?[{[T]:!0,tag:null,key:void 0,children:[]}]:[{[T]:!0,key:void 0,tag:y,value:t,children:[]}])}function Ce(e,t){const{component:n}=e;return je(e,e.delivered,Se(e.iRender,t,e.context,n[q]),e.context.slots,xe(n[F]),Boolean(e.native))}let De;function Oe(e){De=e}function Ne(e){De?De.push(e):e()}class Pe{constructor(e,t,n=(null==t?void 0:t.delivered)||Object.create(null),o){r(this,"events",new u),r(this,"emit",this.events.emit),r(this,"on",this.events.on),r(this,"eventCancelHandles",new Set),r(this,"iRender",void 0),r(this,"components",Object.create(null)),r(this,"config",Object.create(null)),r(this,"parentDelivered",void 0),r(this,"delivered",void 0),r(this,"exposed",function(e){const t={$parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.exposed}},$component:{configurable:!0,value:null},$isContainer:{configurable:!0,value:!1},$created:{configurable:!0,get:()=>e.created},$destroyed:{configurable:!0,get:()=>e.destroyed},$mounted:{configurable:!0,get:()=>e.mounted},$unmounted:{configurable:!0,get:()=>e.unmounted}};return Object.create(null,t)}(this)),r(this,"entity",function(e){const t={exposed:{configurable:!0,get:()=>e.exposed},delivered:{configurable:!0,get:()=>e.delivered},parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.entity}},component:{configurable:!0,value:null},isContainer:{configurable:!0,value:!1},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},$_hooks:{configurable:!0,value:Object.create(null)},$_valueIndex:{configurable:!0,value:0,writable:!0},$_values:{configurable:!0,value:[]},callHook:{configurable:!0,value(e){O(e,n)}},setHook:{configurable:!0,value:(e,t)=>D(e,t,n)},refresh:{configurable:!0,value:e.refresh.bind(e)},on:{configurable:!0,value:e.on},emit:{configurable:!0,value:e.emit},config:{configurable:!0,value:e.config}},n=Object.create(null,t);return n}(this)),r(this,"parent",void 0),r(this,"native",void 0),r(this,"created",!1),r(this,"destroyed",!1),r(this,"mounted",!1),r(this,"unmounted",!1),r(this,"children",new Set),r(this,"tree",[]),r(this,"container",void 0),r(this,"_render",()=>[]),r(this,"_needRefresh",!1),r(this,"_delayedRefresh",0),r(this,"_refreshing",!1),r(this,"_nodes",[]),r(this,"childNodes",[]),r(this,"__executed_destroy",!1),r(this,"__executed_mount",!1),r(this,"__executed_mounted",!1),r(this,"_cancelDrawMonitor",void 0),this.iRender=e,this.parentDelivered=n,this.delivered=Object.create(n),t&&(this.parent=t),this.container=o||this}get canRefresh(){return!A(this)&&!this._delayedRefresh}get needRefresh(){if(A(this))return!1;if(this._delayedRefresh)return!1;const e=this._needRefresh;return this._needRefresh=!1,e}requestDraw(){}async asyncRefresh(e){try{return this._delayedRefresh++,await e()}finally{this._delayedRefresh--,this.refresh()}}refresh(e,t){if("function"==typeof e){if(t)return this.asyncRefresh(e);try{return this._delayedRefresh++,e()}finally{this._delayedRefresh--,this._delayedRefresh<=0&&this.refresh()}}if(this.destroyed)return;if(this._needRefresh=!0,!this.created)return;if(this._refreshing)return;let n;for(this._refreshing=!0;this.needRefresh;)if(n=this._render(),this.destroyed)return;this._refreshing=!1,this.canRefresh&&n&&(this._nodes=Fe(this,n,this._nodes),this.mounted&&(this.destroyed||this.unmounted||this.requestDraw()))}callHook(e){O(e,this.entity)}_update(e,t){this.childNodes=t}update(e,t){this._update(e,t)}_destroy(){}destroy(){this.__executed_destroy||(this.__executed_destroy=!0,this.callHook("beforeDestroy"),this._destroy(),this.callHook("destroyed"),this.destroyed=!0)}_mount(){}mount(){if(this.__executed_destroy)return;if(this.__executed_mount)return;this.__executed_mount=!0,this.callHook("beforeMount");const e=t.exec(e=>e&&this.requestDraw(),()=>{this._mount(),this.mounted=!0});this._cancelDrawMonitor=e.stop,Ne(()=>this.callHook("mounted"))}_unmount(){}unmount(){this.mounted&&(this.__executed_mounted||(this.__executed_mounted=!0,this.callHook("beforeUnmount"),this._unmount(),this.callHook("unmounted"),this.unmounted=!0))}_draw(){}draw(){var e;if(this.__executed_destroy)return;null===(e=this._cancelDrawMonitor)||void 0===e||e.call(this),this.callHook("beforeDraw");const n=t.exec(e=>e&&this.requestDraw(),()=>this._draw());this._cancelDrawMonitor=n.stop,Ne(()=>this.callHook("drawn"))}}function He(e,t,n){we(e.props,t,{},!1,!0),e.events.updateInProps(t);const r=Object.create(null),{native:o}=e,i=ye(e.iRender,n,r,Boolean(o));ge(r,e.slots),o&&(e.nativeNodes=Fe(e,i,e.nativeNodes),e.mounted&&e.requestDraw())}class $e extends Pe{constructor(e,n,o,i,s){var c,a;super(i.iRender,i,s,i.container),r(this,"component",void 0),r(this,"props",t.encase(Object.create(null))),r(this,"slots",t.encase(Object.create(null))),r(this,"_stopRender",void 0),r(this,"nativeNodes",void 0),r(this,"shadowTree",[]),r(this,"nativeTree",[]),r(this,"_shadow",void 0),r(this,"context",void 0),r(this,"parent",void 0),this.component=e,Object.assign(this.config,e[K]),Object.assign(this.components,e[F]),Reflect.defineProperty(this.exposed,"$component",{value:e,enumerable:!0,configurable:!0}),[this.native,this._shadow]="native"===e[z]&&(null===(c=(a=this.iRender).component)||void 0===c?void 0:c.call(a))||[],this.parent=i,i.children.add(this.exposed);const l=R({slots:(d=this).slots,get created(){return d.created},get parent(){return d.parent.exposed},get delivered(){return d.parentDelivered},get children(){return d.children},get childNodes(){return d.childNodes},get emit(){return d.emit},refresh(e){d.refresh(e)}},d.exposed);var d;this.context=l,this.callHook("beforeCreate"),this.childNodes=o,S(()=>He(this,n,o));const{render:u,nodes:f,stopRender:h}=function(e){const{component:n,props:r,context:o,entity:i}=e,s=t=>t&&e.refresh(),c=t.exec(s,()=>_(()=>n(r,o,W),i),{resultOnly:!0});if("function"==typeof c){const n=t.monitor(s,()=>Ce(e,c()));return{nodes:n(),render:n,stopRender:()=>n.stop()}}const a=t.monitor(s,()=>Ce(e,_(()=>n(r,o,W),i)));return{nodes:t.exec(s,()=>Ce(e,c),{resultOnly:!0}),render:a,stopRender:()=>a.stop()}}(this);this._render=u,this._stopRender=h,this._nodes=Fe(this,f),this.callHook("created"),this.created=!0,this._needRefresh&&this.refresh()}_update(e,t){this.destroyed||(this.childNodes=t,S(()=>He(this,e,t)))}_destroy(){this._stopRender&&this._stopRender(),this.parent.children.delete(this.exposed),Ee(this._nodes)}requestDraw(){this.container.markDraw(this)}_draw(){const{nativeNodes:e,iRender:t,_shadow:n,native:r}=this;r&&e&&n?(this.shadowTree=pe(t,this._nodes,this.shadowTree),this.nativeTree=pe(t,e,this.nativeTree)):this.tree=pe(t,this._nodes,this.tree)}_mount(){const{nativeNodes:e,iRender:t,_shadow:n,native:r,_nodes:o}=this;if(r&&e&&n){this.tree=pe(t,Fe(this,r)),this.shadowTree=pe(t,o);for(const e of oe(this.shadowTree))t.insert(n,e);this.nativeTree=pe(t,e);for(const e of oe(this.nativeTree))t.insert(r,e)}else this.tree=pe(t,o)}_unmount(){const{iRender:e,nativeTree:t}=this;ie(e,this.tree),t&&ie(e,t)}}function Ve(e){return!1===e||null==e?null:L(e)?e:{[T]:!0,tag:"Neep:Value",key:e,value:e,children:[]}}function Ee(e){if(Array.isArray(e))return void e.forEach(e=>Ee(e));const{component:t}=e;t&&t.destroy()}function Ie(e,t,n){if(!n)return{tag:null,key:void 0,children:[]};const{tag:r}=n;if(!r)return{tag:null,key:void 0,children:[]};if("string"!=typeof r)return"simple"===r[z]?{...n,children:Me(e,t,n.children),component:void 0}:{...n,children:[],component:new $e(r,n.props||{},n.children,e,t)};const o=r.toLowerCase();if("neep:container"===o){var i;const r=null==n?void 0:null===(i=n.props)||void 0===i?void 0:i.type,o=r?a(r):e.iRender;return{...n,children:[],component:new Be(o,n.props||{},n.children,e,t)}}if("neep:value"===o)return{...n,children:[]};if("neep:deliver"===o){const r={...n.props};delete r.ref,delete r.slot,delete r.key;const o=we(Object.create(t),r,{},!0);return{...n,delivered:o,children:Me(e,o,n.children)}}return o.substr(0,5),{...n,children:Me(e,t,n.children)}}function Te(e,t,n,r){Array.isArray(r)||(r=[r]);const o=[];for(const i of Y(n)){const n=Ve(i);if(!n)continue;const s=r.findIndex(e=>e.tag===n.tag&&e.key===n.key);s>=0?(o.push(ze(e,t,n,r[s])),r.splice(s,1)):o.push(Ie(e,t,n))}return Ee(r),o}function ze(e,t,n,r){if(!r)return Ie(e,t,n);if(!n)return Ee(r),{tag:null,key:void 0,children:[]};if(Array.isArray(r)){if(!r.length)return Ie(e,t,n);const o=r.findIndex(e=>e.tag===n.tag);if(o<0)return Ee(r),Ie(e,t,n);const i=r;[r]=r.splice(o,1),Ee(i)}const{tag:o}=n;if(o!==r.tag)return Ee(r),Ie(e,t,n);if(!o)return{tag:null,key:void 0,children:[]};if("string"!=typeof o){if("simple"===o[z])return{...n,children:[...qe(e,t,n.children,r.children)],component:void 0};const{component:i}=r;return i?(i.update(n.props||{},n.children),{...n,children:[],component:i}):Ie(e,t,n)}const i=o.toLowerCase();if("neep:container"===i){var s;const{component:o}=r;if(!o)return Ie(e,t,n);const i=null==n?void 0:null===(s=n.props)||void 0===s?void 0:s.type;return(i?a(i):e.iRender)!==o.iRender?Ie(e,t,n):(o.update(n.props||{},n.children),{...n,children:[],component:o})}if("neep:value"===i)return{...n,children:[]};if("neep:deliver"===i){const o={...n.props};delete o.ref,delete o.slot,delete o.key;const i=we(r.delivered||Object.create(t),o,r.props,!0);return{...n,delivered:i,children:[...qe(e,t,n.children,r.children)]}}return i.substr(0,5),{...n,children:[...qe(e,t,n.children,r.children)]}}function Me(e,t,n){return Array.isArray(n)||(n=[n]),n.length?n.map(n=>Array.isArray(n)?[...Y(n)].map(n=>Ie(e,t,Ve(n))):Ie(e,t,Ve(n))):[]}function*qe(e,t,n,r){Array.isArray(n)||(n=[n]);let o=0,i=Math.min(n.length,n.length);for(;o<i;o++){const i=n[o];Array.isArray(i)?yield Te(e,t,i,r[o]):yield ze(e,t,Ve(i),r[o])}if(i=Math.max(n.length,n.length),r.length>i)for(;o<i;o++)Ee(r[o]);if(n.length>i)for(;o<i;o++){const r=Ve(n[o]);Array.isArray(r)?yield[...Y(r)].map(n=>Ie(e,t,n)):yield Ie(e,t,r)}}function Fe(e,t,n){return n?[...qe(e,e.delivered,t,n)]:Me(e,e.delivered,t)}let Ke=new Set,Le=!1;class Be extends Pe{constructor(e,t,n,o,i){super(e,o,i),r(this,"props",void 0),r(this,"content",[]),r(this,"_node",null),r(this,"_container",null),r(this,"rootContainer",this),r(this,"_drawChildren",!1),r(this,"_drawContainer",!1),r(this,"_awaitDraw",new Set),r(this,"_needDraw",!1),r(this,"_containers",new Set),this.props=t,this.parent=o,o&&(this.rootContainer=o.container.rootContainer),this.callHook("beforeCreate"),this._render=()=>n,this._nodes=Fe(this,n),this.callHook("created"),this.created=!0}setChildren(e){this.destroyed||(this.childNodes=e,this._render=()=>e,this._drawChildren=!0,this.refresh())}setProps(e){this.destroyed||(this.props=e,this._drawContainer=!0,this.refresh())}update(e,t){this.refresh(()=>{this.setProps(e),this.setChildren(t)})}requestDraw(){this.markDraw(this)}_mount(){const{props:e,parent:t,iRender:n}=this,r=pe(this.container.iRender,this._nodes);this.content=r;const[o,i]=n.mount(e,null==t?void 0:t.iRender);for(const e of oe(r))n.insert(o,e);this.tree=[X({tag:y,key:void 0,component:void 0,node:i,value:i,children:[]})],this._node=i,this._container=o}_destroy(){Ee(this.content)}_unmount(){const{parent:e,iRender:t}=this;e&&ie(e.iRender,this.tree),t.unmount(this._container,this._node,Boolean(e)),ie(this.iRender,this.content)}_draw(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,null===(n=this.parent)||void 0===n?void 0:n.iRender);this.parent&&this.parent.iRender!==this.iRender||(this._drawChildren=!1,e&&(this.content=pe(this.iRender,this._nodes,this.content)))}_drawSelf(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._needDraw=!1,this._drawChildren=!1,this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,null===(n=this.parent)||void 0===n?void 0:n.iRender,!0);e&&(this.content=pe(this.iRender,this._nodes,this.content))}drawSelf(){this.mounted&&(this.destroyed||(this.callHook("beforeDraw"),t.exec(e=>e&&this.markDraw(this),()=>this._drawSelf()),Ne(()=>this.callHook("drawn"))))}markDraw(e,t=!1){var n;(null===(n=this.parent)||void 0===n?void 0:n.iRender)!==this.iRender?(e===this&&this.parent?(this.parent.container.markDraw(this,t),this._needDraw=!t):t?this._awaitDraw.delete(e):this._awaitDraw.add(e),this.rootContainer.markDrawContainer(this,!this._needDraw&&!this._awaitDraw.size||this.destroyed)):this.parent.container.markDraw(e,t)}drawContainer(){const{_node:e,_container:t,_awaitDraw:n}=this;if(!e||!t)return;this.callHook("beforeDraw");const r=this._needDraw;this._needDraw=!1;const o=[...n];n.clear(),r&&this.drawSelf(),o.map(e=>e.draw()),this.iRender.draw(t,e),Ne(()=>this.callHook("drawn"))}markDrawContainer(e,t=!1){var n;t?this._containers.delete(e):this._containers.add(e),n=this,Ke.add(n),Le||(Le=!0,s(()=>{Le=!1;const e=[...Ke];Ke.clear(),e.map(e=>e.drawAll())}))}drawAll(){const e=this._containers;if(!e.size)return;this.callHook("beforeDrawAll");const t=[],n=[];Oe(n),ee(t);const r=[...e];e.clear(),r.forEach(e=>e.drawContainer()),ee(),t.forEach(e=>e()),n.forEach(e=>e()),this.callHook("drawnAll")}}function Ue(e,t){return n=>(n[e]=t,n)}function Ge(e,t,n){return r=>{let o=r[e];return o||(o=Object.create(null),r[e]=o),o[t]=n,r}}function Je(e,t){return t?(t[M]=e,t):Ue(M,e)}function Qe(e){return e?(e[z]="simple",e):Ue(z,"simple")}function We(e,...t){for(const n of t)n(e);return e}Object.defineProperty(e,"asValue",{enumerable:!0,get:function(){return t.asValue}}),Object.defineProperty(e,"computed",{enumerable:!0,get:function(){return t.computed}}),Object.defineProperty(e,"encase",{enumerable:!0,get:function(){return t.encase}}),Object.defineProperty(e,"isValue",{enumerable:!0,get:function(){return t.isValue}}),Object.defineProperty(e,"recover",{enumerable:!0,get:function(){return t.recover}}),Object.defineProperty(e,"value",{enumerable:!0,get:function(){return t.value}}),Object.defineProperty(e,"valueify",{enumerable:!0,get:function(){return t.valueify}}),e.Container="Neep:Container",e.Deliver="Neep:Deliver",e.Error=o,e.EventEmitter=u,e.Fragment=m,e.ScopeSlot=f,e.Slot=p,e.SlotRender=h,e.Tags=g,e.Template=v,e.Value=y,e.addContextConstructor=function(e){w.push(t.safeify(e))},e.callHook=O,e.checkCurrent=b,e.componentsSymbol=F,e.configSymbol=K,e.create=function(e,t){return"function"==typeof t&&(e[q]=t),e},e.createElement=B,e.defineAuxiliary=function(e,t){Reflect.defineProperty(W,e,{get:t,enumerable:!0,configurable:!0})},e.deliver=E,e.elements=U,e.expose=V,e.hook=H,e.install=function(e){e.monitorable,function(e){e&&(c[e.type]=e,i||(c.default||(c.default=e),!i&&e.nextFrame&&(c.default=e,i=e.nextFrame)))}(e.render)},e.isElement=L,e.isElementSymbol=T,e.isProduction=!0,e.label=J,e.lazy=function(e,n){const r=t.value(0),o=t.value(void 0);return We((function(t,{childNodes:i},{createElement:s}){const c=o();return c?s(c,t,...i):(async function(){if(!r()){r(1);try{const t=await e();if("function"==typeof t)return void o(t);if(!t)return void r(-1);if("function"==typeof t.default)return void o(t.default);r(-1)}catch(e){r(-1)}}}(),n?s(n,{loading:r()>0}):null)}),Qe,Je("Lazy"))},e.mComponent=function(e,t,n){const r=Ge(F,e,t);return n?r(n):r},e.mConfig=function(e,t,n){const r=Ge(K,e,t);return n?r(n):r},e.mName=Je,e.mNative=function(e){return e?(e[z]="native",e):Ue(z,"native")},e.mRender=function(e,t){return t?(t[q]=e,t):Ue(q,e)},e.mSimple=Qe,e.mType=function(e,t){return t?(t[z]=e,t):Ue(z,e)},e.mark=We,e.nameSymbol=M,e.refresh=S,e.register=function(e,t){Re[e]=t},e.render=function(e,t={}){let n={...t};const r=new Be(a(t.type),n,void 0===e?[]:L(e)?[e]:[B(e)]),{exposed:o}=r;return Reflect.defineProperty(o,"$update",{value:e=>(r.setChildren(void 0===e?[]:L(e)?[e]:[B(e)]),o),configurable:!0}),Reflect.defineProperty(o,"$mount",{value:e=>o.$mounted?o:(e&&(n.target=e,r.setProps(n)),r.mount(),o),configurable:!0}),Reflect.defineProperty(o,"$unmount",{value(){if(o.$mounted&&!o.$unmounted)return o.$destroyed?r.destroy():void r.unmount()},configurable:!0}),n.target&&r.mount(),o},e.renderSymbol=q,e.setAuxiliary=function(e,t){Reflect.defineProperty(W,e,{value:t,enumerable:!0,configurable:!0})},e.setHook=D,e.typeSymbol=z,e.useValue=P,e.version="0.1.0-alpha.10",e.watch=N,Object.defineProperty(e,"__esModule",{value:!0})}));
