/*!
 * NeepHtmlRenderer v0.1.0-alpha.15
 * (c) 2019-2020 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@neep/core")):"function"==typeof define&&define.amd?define(["exports","@neep/core"],t):t((e=e||self).NeepHtmlRenderer={},e.Neep)}(this,(function(e,t){"use strict";function n(e,n,o){const r="string"==typeof(i=t.isValue(e.id)?e.id():e.id)?i:"number"==typeof i?String(i):void 0;var i;return r!==o&&("string"==typeof r?n.id=e.id:n.removeAttribute("id")),r}function o(e){const n=new Set;for(const o of function*e(n){if(t.isValue(n))yield*e(n());else if(Array.isArray(n))for(const t of n)yield*e(t);else yield n}(e))if(o)if("string"==typeof o)for(let e of o.split(" ").filter(Boolean))n.add(e);else if("object"==typeof o)for(const e in o){const t=o[e];for(let o of e.split(" ").filter(Boolean))n[t?"add":"delete"](o)}if(n.size)return n}function r(e,n,r){const i=o(t.isValue(e.class)?e.class():e.class);return function(e,t,n){if(t&&n){const o=e.getAttribute("class")||"",r=new Set(o.split(" ").filter(Boolean));n.forEach(e=>r.delete(e)),t.forEach(e=>r.add(e)),e.setAttribute("class",[...r].join(" "))}else t?e.setAttribute("class",[...t].join(" ")):n&&e.removeAttribute("class")}(n,i,r),i}const i={width:"px",height:"px",top:"px",right:"px",bottom:"px",left:"px",border:"px","border-top":"px","border-right":"px","border-left":"px","border-bottom":"px","border-width":"px","border-top-width":"px","border-right-width":"px","border-left-width":"px","border-bottom-width":"px","border-radius":"px","border-top-left-radius":"px","border-top-right-radius":"px","border-bottom-left-radius":"px","border-bottom-right-radius":"px",padding:"px","padding-top":"px","padding-right":"px","padding-left":"px","padding-bottom":"px",margin:"px","margin-top":"px","margin-right":"px","margin-left":"px","margin-bottom":"px"};function a(e,n,o,r){if(!r)return;const a=function(e){if(t.isValue(e)&&(e=e()),"string"==typeof e)return e;if(!e)return;if("object"!=typeof e)return;const n=Object.create(null);for(let o in e){let r=e[o];t.isValue(r)&&(r=r());const a="--"===o.substr(0,2)?o:o.replace(/[A-Z]/g,"-$1").replace(/-+/g,"-").toLowerCase();if("number"==typeof r){const e=r&&o in i?`${r}${i[o]}`:""+r;n[a]=[e,void 0]}else if(r&&"string"==typeof r){const e=r.replace(/!important\s*$/,"");n[a]=[e,e===r?void 0:"important"]}}return n}(t.isValue(e.style)?e.style():e.style);return function(e,t,n){if(t)if("string"!=typeof t)if(n&&"string"!=typeof n){for(const o of Object.keys(t)){const r=t[o];n[o]&&n[o][0]===r[0]&&n[o][1]===r[1]||e.setProperty(o,...r)}for(const o of Object.keys(n))t[o]||e.removeProperty(o)}else{"string"==typeof n&&(e.cssText="");for(const n of Object.keys(t))e.setProperty(n,...t[n])}else t!==typeof n&&(e.cssText=t);else{if(!n)return;if("string"==typeof n)return void(e.cssText="");for(const t of Object.keys(n))e.removeProperty(t)}}(n,a,o),a}function s(e,t=!1){return null==e?e:t&&"function"==typeof e?void 0:"boolean"==typeof e?e?"":null:"object"!=typeof e?String(e):e instanceof Date?e.toISOString():e instanceof RegExp?e.toString():JSON.stringify(e)}function c(e,n,o,r){const i=function(e,n){const o=Object.create(null);for(const r in e){if(/^(n|on|bind|slot)[:-]/.test(r))continue;if(!/^[a-zA-Z:_][a-zA-Z0-9:_-]*$/.test(r))continue;const i=r.toLowerCase();switch(i){case"style":if(!n)break;case"ref":case"is":case"id":case"class":continue}let a=e[r];t.isValue(a)&&(a=a());const c=s(a,"on"===i.substr(0,2));void 0!==c&&(o[i]=c)}return o}(e,r);return function(e,t,n){for(const o of Object.keys(t)){const r=t[o];o in n&&n[o]===r||(null===r?e.removeAttribute(o):e.setAttribute(o,r))}for(const o of Object.keys(n))o in t||e.removeAttribute(o)}(n,i,o),function(e,t){if(e instanceof HTMLInputElement&&"checked"in t)switch(e.type.toLowerCase()){case"checkbox":case"radio":null!==t.checked!==e.checked&&(e.checked=null!==t.checked)}if((e instanceof HTMLSelectElement||e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&"value"in t){const n=t.value||"";e.value!==n&&(e.value=n)}if(e instanceof HTMLDetailsElement&&"open"in t){const n=null!==t.open;e.open!==n&&(e.open=n)}if(e instanceof HTMLMediaElement){if("muted"in t){const n=null!==t.muted;e.muted!==n&&(e.muted=n)}if("paused"in t){const n=null!==t.paused;e.paused!==n&&(n?e.pause():e.play())}if("currentTime"in t){const n=t.currentTime;if(n&&/^\d+(\.\d+)?$/.test(n)){const t=Number(n);e.currentTime!==t&&(e.currentTime=t)}}if("playbackRate"in t){const n=t.playbackRate;if(n&&/^\d+(\.\d+)?$/.test(n)){const t=Number(n);e.playbackRate!==t&&(e.playbackRate=t)}}if("volume"in t){const n=t.volume;if(n&&/^\d+(\.\d+)?$/.test(n)){const t=Number(n);e.volume!==t&&(e.volume=t)}}}}(n,i),i}function l(e){if("on"!==e.substr(0,2))return"";let t=e.substr(2);return":"===t[0]||"-"===t[0]?"":t}function u(e,n,o=function(){const e=new t.EventEmitter;return e.__eventBind=Object.create(null),e}()){o.updateInProps(e,o=>{for(const t in e){const n=e[t];if("function"!=typeof n)continue;const r=l(t);r&&o(r,n)}for(const[r,i,a]of function*(e){if(e instanceof HTMLInputElement){switch(e.type.toLowerCase()){case"checkbox":return yield["indeterminate","change",e=>e.currentTarget.indeterminate],yield["checked","change",e=>e.currentTarget.checked];case"radio":return yield["checked","change",e=>e.currentTarget.checked]}return yield["value","input",e=>e.currentTarget.value]}return e instanceof HTMLTextAreaElement?yield["value","input",e=>e.currentTarget.value]:e instanceof HTMLSelectElement?yield["value","change",e=>e.currentTarget.value]:e instanceof HTMLDetailsElement?yield["open","toggle",e=>e.currentTarget.open]:e instanceof HTMLMediaElement?(yield["currentTime","timeupdate",e=>e.currentTarget.currentTime],yield["playbackRate","ratechange",e=>e.currentTarget.playbackRate],yield["volume","volumechange",e=>e.currentTarget.volume],yield["muted","volumechange",e=>e.currentTarget.muted],yield["paused","playing",e=>e.currentTarget.paused],yield["paused","pause",e=>e.currentTarget.paused]):void 0}(n)){const n=e[r];t.isValue(n)&&o(i,e=>n(a(e)))}});const r=new Set(o.names.map(String)),i=o.__eventBind;for(const e of Object.keys(i))r.has(e)||(i[e](),delete i[e]);const{emit:a}=o;for(const e of r){if(e in i)continue;const t=(...t)=>a(e,...t);n.addEventListener(e,t),i[e]=()=>{n.removeEventListener(e,t)}}return o}const f=new WeakMap;let d;const p={svg:"http://www.w3.org/2000/svg",html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML"},m=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"]),g=new Set(["maction","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msubsup","msup","mtable","mtd","mtext","mtr","munder","munderover","semantics"]);function h(e,t){const n=/^([a-z][a-z0-9-]*):([a-z0-9-]+)$/i.exec(e),o=n?n[2]:e,r=(t||(null==n?void 0:n[1])||m.has(o.toLowerCase())&&"svg"||g.has(o.toLowerCase())&&"mathml"||"").toLowerCase();return r?document.createElementNS(r in p&&p[r]||r,o):document.createElement(o)}const y=/^[a-z][a-z0-9]*(?:-[a-z0-9]+)?(?::[a-z0-9]+(?:-[a-z0-9]+)?)?$/i;const b={type:"web",nextFrame:function(e){d?d.push(e):(d=[e],window.requestAnimationFrame(()=>{const e=d;d=void 0,e&&e.forEach(e=>e())}))},isNode:e=>e instanceof Node,mount({target:e,class:n,style:o,tag:r},i){t.isValue(e)&&(e=e.value),function(e){return"string"==typeof e&&y.test(e)}(r)||(r="div");const a=b.createElement(r);return b.updateProps(a,{class:n,style:o}),null===e?i?[a,i.createPlaceholder()]:[a,a]:("string"==typeof e&&(e=document.querySelector(e)),e instanceof Element?(e.appendChild(a),i?[a,i.createPlaceholder()]:[a,a]):i!==b?(document.body.appendChild(a),[a,a]):[a,a])},unmount(e,t,n){e===t&&n||e.remove()},drawContainer(e,n,{target:o,class:r,style:i,tag:a},s){b.updateProps(e,{class:r,style:i}),t.isValue(o)&&(console.log(o),o=o.value);const c=s===b&&e===n?void 0:b.getParent(n);if(null===o)return null===c?[e,n]:(e!==n&&e.remove(),s?[e,s.createPlaceholder()]:[e,e]);if("string"==typeof o&&(o=document.querySelector(o)),s===b||o instanceof Element||(o=document.body),c===o)return[e,n];if(s!==b)return o.appendChild(e),[e,n];if(!c){const t=s.createPlaceholder(),r=s.getParent(n);return r&&(b.insertNode(r,t,n),b.removeNode(n)),o.appendChild(e),[e,t]}if(!o){const t=s.getParent(n);return t&&(b.insertNode(t,e,n),b.removeNode(n)),[e,e]}return o.appendChild(e),[e,n]},drawNode(){},createElement:e=>h(e),createText:e=>document.createTextNode(e),createPlaceholder:()=>document.createComment(""),createComponent(){const e=h("neep-component");return[e,e.attachShadow({mode:"open"})]},getParent:e=>e.parentNode,nextNode:e=>e.nextSibling,updateProps(e,t){!function(e,t){const o=e.style,i=o instanceof CSSStyleDeclaration,s=f.get(e)||{attrs:{}},l=n(t,e,s.id),d=r(t,e,s.classes),p=a(t,o,s.style,i),m=c(t,e,s.attrs,i),g=u(t,e,s.event);f.set(e,{id:l,classes:d,style:p,attrs:m,event:g})}(e,t)},insertNode(e,t,n=null){e.insertBefore(t,n)},removeNode(e){const t=b.getParent(e);t&&t.removeChild(e)},getRect(e){if(e instanceof Element){const{top:t,right:n,bottom:o,left:r,width:i,height:a}=e.getBoundingClientRect();return{top:t,right:n,bottom:o,left:r,width:i,height:a}}if(e instanceof ShadowRoot){const{top:t,right:n,bottom:o,left:r,width:i,height:a}=e.host.getBoundingClientRect();return{top:t,right:n,bottom:o,left:r,width:i,height:a}}return null}};function v(e){}t.install({render:b});var x=Object.freeze({__proto__:null,install:v});e.default=x,e.install=v,Object.defineProperty(e,"__esModule",{value:!0})}));
